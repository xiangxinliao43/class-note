

# 零碎知识
## 1.字、字长、机器字长、存储字长、存储容量、总线宽度
字长 = 机器字长 = CPU 总线宽度 [ 一般是地址总线和数据总线 ] = CPU 位数 = 通用寄存器位数
机器字长：CPU 进行一次整数运算所能处理的二进制数据的位数(通常和 ALU 相关)。在计算机中是不变的。
存储字长：一个存储单元中的二进制代码的位数	(通常和 MDR 位数相同)。
指令字长：一条指令的总长度，可能会变。
### 位
bit
### 字节
Byte
1Byte = 8 bit
1MB = 106B
### 字
16 bit 通常为 1 字。
代表计算机处理指令或数据的二进制数位，是计算机进行数据存储和数据处理的单位。
### 字长
同一时间处理的二进制位数是字长。
处理 8 位数据的 CPU 叫 8 位 CPU，还有 32 位 CPU。
### 总线宽度
总线在单位时间内处理的数据总数。


# 第一章 计算机系统概览
## 1.0 reviewing
### 计算机系统硬件系统的组成以及各部分的功能

1. 吞吐量
一台计算机在某一段时间间隔内能够处理的信息量。
2. 响应时间
表征从输入有效道计算机系统响应之间的时间度量。ms、us。
3. 利用率
给定时间间隔内，系统被实际使用的时间所占的比率，用百分比表示。
4. 基本字长
指 CPU 一次能够完成的二进制运算的位数。
字长越高，计算机精度越高。
8、16、32、64。
5. 存储容量
存储器中所有存储单元的总数目。KB、MB、GB、TB。
6. 指令执行速度
7. CPU 主频
8. 系统总线
9. 外设配置
10. 系统软件配置
11. 指令系统/MIPS
### 冯·诺依曼机制的基本思想
### 指令流和数据流、指令字和数据字
### 计算机软件的组成与分类
### 计算机系统的层次结构
### 计算机系统的性能指标


# 第二章 运算方法和运算器
## 2.1.1 进位计数制
第一章回顾：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703154957468-e1af320a-070e-4b83-9360-a3710061f11e.png#averageHue=%23ecebea&clientId=u8de53474-843e-4&from=paste&height=805&id=uf9784276&originHeight=805&originWidth=1422&originalType=binary&ratio=1&rotation=0&showTitle=false&size=253176&status=done&style=none&taskId=uf3cfa96c-4f77-43b9-92d4-567015d12e3&title=&width=1422)
问题引入：
数据（数字，文本等）如何在计算机中表示？
运算器如何实现数据运算与逻辑运算。

先总览一下进位计数制：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703155144032-e6fed6ea-7b5e-41cb-aa99-ccd30cde410d.png#averageHue=%23fdfbf6&clientId=u8de53474-843e-4&from=paste&height=593&id=u256bafae&originHeight=593&originWidth=1566&originalType=binary&ratio=1&rotation=0&showTitle=false&size=352022&status=done&style=none&taskId=uc8a3830c-f587-4e45-a2a2-d9c015df6e4&title=&width=1566)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703155703540-60a6e6fd-f626-410d-8518-61856a530aeb.png#averageHue=%23232323&clientId=u8de53474-843e-4&from=paste&height=543&id=u48949d0b&originHeight=460&originWidth=719&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12117&status=done&style=none&taskId=u91c1381d-aa18-413e-9862-104464b72c1&title=&width=848)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156164959-813124cc-df7b-4371-b92b-abe75625392a.png#averageHue=%23f2f2ef&clientId=u8de53474-843e-4&from=paste&height=241&id=u766b1112&originHeight=239&originWidth=863&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102204&status=done&style=none&taskId=u040457fd-6ed4-4ad0-944d-f01411ecced&title=&width=870)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156244682-d1c2fd07-9b8f-4523-9883-9a9790c16da4.png#averageHue=%2399bcdd&clientId=u8de53474-843e-4&from=paste&height=121&id=uf6948f0b&originHeight=121&originWidth=1698&originalType=binary&ratio=1&rotation=0&showTitle=false&size=226889&status=done&style=none&taskId=u46032d33-6c47-404e-a598-20cdcb17210&title=&width=1698)
2 -> 8 -> 16
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156616942-19abd3a6-1810-487a-b7cf-17ac8f836df6.png#averageHue=%23f3f3eb&clientId=u817d3cb9-6f86-4&from=paste&height=529&id=u799d06d9&originHeight=254&originWidth=726&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190848&status=done&style=none&taskId=ue880d0e7-4b0b-4d1a-af95-d70bd0d0f25&title=&width=1511)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156370007-a790c188-9a4b-4e95-baf4-33a41d7150cf.png#averageHue=%23edede4&clientId=u817d3cb9-6f86-4&from=paste&height=875&id=ucaf7f960&originHeight=373&originWidth=689&originalType=binary&ratio=1&rotation=0&showTitle=false&size=227402&status=done&style=none&taskId=uc23e6457-b7e9-40aa-ad79-f4f6d24c75c&title=&width=1616)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156629756-5a5010ec-50fc-4a0f-9e94-dabe8129dd28.png#averageHue=%23ecebe3&clientId=u817d3cb9-6f86-4&from=paste&height=605&id=u7c3e358f&originHeight=239&originWidth=604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=121675&status=done&style=none&taskId=u6b7178e5-72b8-49da-ac2b-12988f47c57&title=&width=1528)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156633599-0efb4d5c-353b-47b4-a75a-977af41b557b.png#averageHue=%23efefe6&clientId=u817d3cb9-6f86-4&from=paste&height=632&id=ueacad733&originHeight=221&originWidth=641&originalType=binary&ratio=1&rotation=0&showTitle=false&size=144598&status=done&style=none&taskId=u419c04c7-b1ef-4721-bb94-c0baac55937&title=&width=1832)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703156824091-cd835e32-6cc4-438f-b40b-9a49a50f3f76.png#averageHue=%23fcfcfb&clientId=u817d3cb9-6f86-4&from=paste&height=787&id=ue7f2d851&originHeight=917&originWidth=1308&originalType=binary&ratio=1&rotation=0&showTitle=false&size=436094&status=done&style=none&taskId=u55c38b2b-2f5e-4761-9a19-c9b21b490c4&title=&width=1123)
## 2.1.2 BCD 码
除了看书还可以看数电部分 BCD 码章节。
4bit 2 进制数去表示 1 位 10 进制数。
8421 码，2421 码，余 3 码。
## 2.1.3 无符号整数的表示和运算
 无符号整数在计算机内部如何表示？
加法、减法运算的实现原理。

机器字长概念：通用寄存器的位数，ALU 一次能进行多少位的运算。
计算机硬件能支持的无符号整数的位数是有限的，就是机器字长的位数。
现在的计算机机器字长大多为 64/32 位。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703162783478-e68aea40-9b08-4ca0-861b-f48eb48e834a.png#averageHue=%23efeceb&clientId=u40625f2f-c51f-4&from=paste&height=742&id=uab79ba58&originHeight=742&originWidth=1736&originalType=binary&ratio=1&rotation=0&showTitle=false&size=934200&status=done&style=none&taskId=uf3a02933-a6f7-4ee1-b768-636a498d04c&title=&width=1736)
存储时，超过的位数是保留低位，高位舍弃。

n bit 寄存器能表示的数的范围：2n - 1

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163330955-dc2a23da-81bf-4586-8799-f70439b27102.png#averageHue=%23f7f7f6&clientId=u40625f2f-c51f-4&from=paste&height=1119&id=u186b7a51&originHeight=1119&originWidth=1998&originalType=binary&ratio=1&rotation=0&showTitle=false&size=669576&status=done&style=none&taskId=ud7d059e0-56fd-4cb3-ac74-6fd58cc8cf9&title=&width=1998)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163342575-8283acc3-5ac9-4bfd-ae7d-f41fc9264feb.png#averageHue=%23f6f5f2&clientId=u40625f2f-c51f-4&from=paste&height=1120&id=uf13146c5&originHeight=1120&originWidth=1996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1021576&status=done&style=none&taskId=u6504646b-32f8-494f-a153-04a73a904c6&title=&width=1996)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163359484-f18395b1-f755-40c4-81b1-e4285cf346c6.png#averageHue=%23f8f7f5&clientId=u40625f2f-c51f-4&from=paste&height=1121&id=u05c074e8&originHeight=1121&originWidth=1993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=945208&status=done&style=none&taskId=u76317d8e-5832-4c25-81b9-bf239c2d5dd&title=&width=1993)
减法也就是利用补码去运算。
## 2.1.4 带符号整数的表示和运算
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163872293-6e9e4aed-54fb-405b-953f-a1b45184ca7c.png#averageHue=%23f8f8f4&clientId=u40625f2f-c51f-4&from=paste&height=902&id=u1ad42efd&originHeight=902&originWidth=1600&originalType=binary&ratio=1&rotation=0&showTitle=false&size=687951&status=done&style=none&taskId=ub22eb4d3-13e2-43c9-9b39-70c87001374&title=&width=1600)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163906708-86bb5d92-7be4-4c7a-a294-97d6d37fa4a1.png#averageHue=%23f3f1ed&clientId=u40625f2f-c51f-4&from=paste&height=904&id=u81605869&originHeight=904&originWidth=1602&originalType=binary&ratio=1&rotation=0&showTitle=false&size=794674&status=done&style=none&taskId=u359f75ab-620a-4125-baf7-9f8d9c1e51d&title=&width=1602)
### 原码
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163610913-5c2edc45-515f-4378-998e-8af79bb05aea.png#averageHue=%23f7f6f3&clientId=u40625f2f-c51f-4&from=paste&height=902&id=u1d71a3b1&originHeight=902&originWidth=1599&originalType=binary&ratio=1&rotation=0&showTitle=false&size=661412&status=done&style=none&taskId=u7287a59b-9253-4abe-ae31-a55e621268e&title=&width=1599)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163858558-865ba0b2-b8a7-442d-b4f4-83cfd9b8a0a8.png#averageHue=%23f7f6f4&clientId=u40625f2f-c51f-4&from=paste&height=898&id=u32a01721&originHeight=898&originWidth=1593&originalType=binary&ratio=1&rotation=0&showTitle=false&size=607878&status=done&style=none&taskId=ud4651d5a-56da-4ba6-8d60-433e6b25ea3&title=&width=1593)
### 反码
反码只是作为原码和补码转换的一种中间状态存在的。
### 补码
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703163997370-5a23d382-2114-49b3-8d20-a83789615601.png#averageHue=%23f6f5f3&clientId=u40625f2f-c51f-4&from=paste&height=904&id=u7fa0eede&originHeight=904&originWidth=1601&originalType=binary&ratio=1&rotation=0&showTitle=false&size=633108&status=done&style=none&taskId=uad221558-61bd-40f0-be74-8045955a15b&title=&width=1601)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703164006383-be969839-e672-45ff-92f5-335ea796051b.png#averageHue=%23f7f7f4&clientId=u40625f2f-c51f-4&from=paste&height=902&id=u0a497e68&originHeight=902&originWidth=1604&originalType=binary&ratio=1&rotation=0&showTitle=false&size=550233&status=done&style=none&taskId=uae55a2ce-e6d1-4100-b269-b0f49a82bd3&title=&width=1604)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703164682910-0f4f534b-f6a3-4558-9b35-bbda4043fee3.png#averageHue=%23f6f5f3&clientId=u40625f2f-c51f-4&from=paste&height=898&id=u785cf6d1&originHeight=898&originWidth=1602&originalType=binary&ratio=1&rotation=0&showTitle=false&size=885763&status=done&style=none&taskId=u3e7e67be-0800-41cb-9d61-a78fb4e6492&title=&width=1602)
### 移码
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165506458-99cae192-238b-4be1-bcfd-a343283b31a7.png#averageHue=%23f9f6f2&clientId=u40625f2f-c51f-4&from=paste&height=1120&id=u66b4fb68&originHeight=1120&originWidth=1999&originalType=binary&ratio=1&rotation=0&showTitle=false&size=956719&status=done&style=none&taskId=u2732f764-6663-4388-b129-846a2708085&title=&width=1999)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165514331-f0a8873c-8c65-4252-99f6-76f274d86dd0.png#averageHue=%23f6f4f4&clientId=u40625f2f-c51f-4&from=paste&height=1124&id=uc96aa1a5&originHeight=1124&originWidth=1995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=745296&status=done&style=none&taskId=ueb3b16e2-1b98-416f-9253-a72de43725c&title=&width=1995)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165523983-c48d260a-4bb0-45fa-959e-bfeb760b26cc.png#averageHue=%23d3c9bf&clientId=u40625f2f-c51f-4&from=paste&height=1123&id=u939feafa&originHeight=1123&originWidth=2001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1687997&status=done&style=none&taskId=u3373b758-86a9-4760-b91b-079eddc48fc&title=&width=2001)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165533483-8d07e110-ffef-41c1-b9bc-6fb84abd758c.png#averageHue=%23f3f3f2&clientId=u40625f2f-c51f-4&from=paste&height=1125&id=uf481232b&originHeight=1125&originWidth=1997&originalType=binary&ratio=1&rotation=0&showTitle=false&size=951234&status=done&style=none&taskId=uf10515fd-fd64-4e8a-ba8b-53c467b6b18&title=&width=1997)
### 总结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165548807-1d4af196-478c-485f-8032-7794a2a80ed6.png#averageHue=%23faf9f7&clientId=u40625f2f-c51f-4&from=paste&height=1117&id=uf5e12ae8&originHeight=1117&originWidth=1999&originalType=binary&ratio=1&rotation=0&showTitle=false&size=796551&status=done&style=none&taskId=ue31d82c0-c4d5-4b28-98db-85024f00cc9&title=&width=1999)
## 2.1.5 原反补码的特性对比
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703164791876-3dc4d125-aaf1-47ac-94c8-c2ada18fa0f9.png#averageHue=%23faf5ee&clientId=u40625f2f-c51f-4&from=paste&height=320&id=ufa0a90c8&originHeight=320&originWidth=1491&originalType=binary&ratio=1&rotation=0&showTitle=false&size=225835&status=done&style=none&taskId=u88d925d7-2bee-474b-a1cc-9676bb25992&title=&width=1491)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703164884578-8b4d8e45-6d13-4230-afe9-cd1b58a9b33a.png#averageHue=%23d1cbc3&clientId=u40625f2f-c51f-4&from=paste&height=766&id=u493b140f&originHeight=766&originWidth=1704&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1137623&status=done&style=none&taskId=u5c95eb4b-d5aa-4e79-911f-1d28ca1447e&title=&width=1704)
## 2.1.6 定点小数
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165807349-1fe73c02-2c45-412f-a91b-7d36a16c113c.png#averageHue=%23f8f7f6&clientId=u40625f2f-c51f-4&from=paste&height=1125&id=u932c0bfe&originHeight=1125&originWidth=1999&originalType=binary&ratio=1&rotation=0&showTitle=false&size=685019&status=done&style=none&taskId=u8be94e86-2fbc-4d45-9ffd-455f054879b&title=&width=1999)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165815828-6c24fbcd-ceb6-4d97-a482-2c1783c61908.png#averageHue=%23f3f1f0&clientId=u40625f2f-c51f-4&from=paste&height=1124&id=ua76fe744&originHeight=1124&originWidth=1995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=757863&status=done&style=none&taskId=u343578a0-9914-4a48-8f63-7d508016524&title=&width=1995)
这里有一个细节就是，1，0010011 和 1.1100000 的两个表示，用，符号来表示是定点整数，用. 符号来表示是定点小数。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165901228-e9ceec6f-4325-462f-85c8-237fd50230d3.png#averageHue=%23f7f7f4&clientId=u40625f2f-c51f-4&from=paste&height=1122&id=u5b4220d5&originHeight=1122&originWidth=2001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=778069&status=done&style=none&taskId=uebb3fc4b-6b28-4256-be79-758c89b9972&title=&width=2001)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165911089-c757b036-225c-4c92-9492-53b607404a1d.png#averageHue=%23e6e2c7&clientId=u40625f2f-c51f-4&from=paste&height=1122&id=u7fa048ae&originHeight=1122&originWidth=1993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1707949&status=done&style=none&taskId=u8db8d62f-dd0f-4232-967c-bc530d0accb&title=&width=1993)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165927705-5f83e066-c184-477f-9fc2-acc657d16d60.png#averageHue=%23f9f9f8&clientId=u40625f2f-c51f-4&from=paste&height=1126&id=uf0e8e0cd&originHeight=1126&originWidth=2002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=580522&status=done&style=none&taskId=u0d994c7a-e027-4247-b808-8df10eb94d9&title=&width=2002)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165963573-8fbd14cf-927a-4eee-bb4f-c5d6d497952f.png#averageHue=%23f4f3f1&clientId=u40625f2f-c51f-4&from=paste&height=1127&id=uc66872f4&originHeight=1127&originWidth=2000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=801912&status=done&style=none&taskId=uc1813a8a-a230-4a66-9dfb-840aa22b4d8&title=&width=2000)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703165987364-15bc7bd5-000b-4737-ae86-d551c20b57e2.png#averageHue=%23f5f4f2&clientId=u40625f2f-c51f-4&from=paste&height=1123&id=u557af3f6&originHeight=1123&originWidth=1995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=744710&status=done&style=none&taskId=u2c44fbe8-583e-48a6-8450-a0fd84a538b&title=&width=1995)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703166003367-487dcc16-bb94-4da5-8950-3fbe0512abbb.png#averageHue=%23f1efe9&clientId=u40625f2f-c51f-4&from=paste&height=1126&id=u9c92369f&originHeight=1126&originWidth=1998&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1218864&status=done&style=none&taskId=u9025283c-0f24-40c5-80b7-e9b81c1130a&title=&width=1998)
## 2.2.1 电路的基本原理、加法器设计
### ALU 算术逻辑单元 Arithmetic and Logic Unit
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703166185398-6d27b6f5-72b7-4dae-8930-4e81ed408ea0.png#averageHue=%23f8f7f7&clientId=u40625f2f-c51f-4&from=paste&height=1126&id=ua9cad83c&originHeight=1126&originWidth=2000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=997621&status=done&style=none&taskId=uf08b32d1-c490-4e87-a9aa-ae2f1103cf6&title=&width=2000)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703166380988-82e28f9a-3e10-476c-b71a-b67123ad6ea2.png#averageHue=%23e9e7da&clientId=u40625f2f-c51f-4&from=paste&height=1124&id=u94f6f276&originHeight=1124&originWidth=1996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1087334&status=done&style=none&taskId=u666d927a-c539-4023-a7d2-1b1bfa3b68b&title=&width=1996)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703166391448-45a3c0e7-1707-46fa-99d7-5689ab00fa02.png#averageHue=%23fbfaf9&clientId=u40625f2f-c51f-4&from=paste&height=1127&id=uc440113f&originHeight=1127&originWidth=1998&originalType=binary&ratio=1&rotation=0&showTitle=false&size=832729&status=done&style=none&taskId=u65ce5a10-6b7f-4056-aa9f-99527d13495&title=&width=1998)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703166421762-a9df4c7f-2fff-43c4-a0c7-4ad1bdfbd00b.png#averageHue=%23f7f7f4&clientId=u40625f2f-c51f-4&from=paste&height=1125&id=u059ee4ff&originHeight=1125&originWidth=2005&originalType=binary&ratio=1&rotation=0&showTitle=false&size=894083&status=done&style=none&taskId=uef5936c5-4a8c-4f9a-a65d-5bd4043c700&title=&width=2005)
## 2.2.2 并行进位加法器

## 2.2.6 定点数乘法运算
这节讲原码补码的乘法运算。
机器实现：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169178389-59ff2473-a250-46a6-9fae-4b664c2669d7.png#averageHue=%23e5e3d4&clientId=u40625f2f-c51f-4&from=paste&height=1127&id=u41653a3f&originHeight=1127&originWidth=1995&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1308705&status=done&style=none&taskId=u82b950e3-aa1d-48c7-9dfc-eadb9c3f0b7&title=&width=1995)
### 原码一位乘法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169378269-c36f7a59-3efe-4bb5-b629-41569dd561a8.png#averageHue=%23f8f8f4&clientId=u40625f2f-c51f-4&from=paste&height=1122&id=u4aefe1cf&originHeight=1122&originWidth=1992&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1111839&status=done&style=none&taskId=udb5b86be-48da-4be7-bc0f-b0a6c836e91&title=&width=1992)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169443923-5b8dff69-4922-44a9-be8c-c04d6deab0bb.png#averageHue=%23f3f2ee&clientId=u40625f2f-c51f-4&from=paste&height=1123&id=uf90a87fa&originHeight=1123&originWidth=1996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1177109&status=done&style=none&taskId=u0c790428-7ea4-4677-9ded-349555ec40c&title=&width=1996)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169479386-56c6e3b5-aff1-4a8a-956b-bf62dba1e93f.png#averageHue=%23f5f3ef&clientId=u40625f2f-c51f-4&from=paste&height=1124&id=ud6f123f3&originHeight=1124&originWidth=2000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1099160&status=done&style=none&taskId=u08f1b15f-2153-452e-8b2d-a1ed1a56372&title=&width=2000)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169577340-90c3a780-500f-4f00-913d-aa208da8c1d4.png#averageHue=%23f2f2ef&clientId=u40625f2f-c51f-4&from=paste&height=1124&id=u99f6caf9&originHeight=1124&originWidth=2000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1552772&status=done&style=none&taskId=uaba49012-e344-447b-ba9c-c4fa5ee5e5a&title=&width=2000)
### 补码一位乘法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169732468-6be7cb9b-aff3-4ea7-9337-12e5f1768d24.png#averageHue=%23e5decc&clientId=u40625f2f-c51f-4&from=paste&height=1126&id=u1e2bfeda&originHeight=1126&originWidth=1993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1401141&status=done&style=none&taskId=u7ce22ad6-eafc-4940-95f0-998fe8d5895&title=&width=1993)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703169771576-d483edce-4378-4696-b846-154da62628d5.png#averageHue=%23e8e4d2&clientId=u40625f2f-c51f-4&from=paste&height=1125&id=u1e9c76d3&originHeight=1125&originWidth=1996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1608409&status=done&style=none&taskId=u54720929-a6b2-47ea-b19a-eae43b863f5&title=&width=1996)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703170346475-1c364a14-2fc5-454e-baf9-e3ffce2daa6a.png#averageHue=%23f3efec&clientId=u40625f2f-c51f-4&from=paste&height=1126&id=uc4107a6e&originHeight=1126&originWidth=1996&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1579862&status=done&style=none&taskId=uc5dcb9ce-5ada-4a43-a1e1-d24471028c1&title=&width=1996)

## 2.2.7 定点数除法运算

计算除法的过程有点抽象。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703330110422-a3200f95-9ae1-443b-8b5c-405ffcc87ef3.png#averageHue=%23f9f8f8&clientId=u6039d051-90c7-4&from=paste&height=751&id=u4fd3e5ce&originHeight=1127&originWidth=1989&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1086775&status=done&style=none&taskId=u4188723a-88cb-41bf-b4e7-ec38234f392&title=&width=1326)
可以看到除法运算是有精度限制的。
类似 0.1 + 0.2 == 0.3 为 false。
### 恢复余数法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703330949365-751c8073-199e-4d4c-81f3-81e600504b8a.png#averageHue=%23e1deb5&clientId=u6039d051-90c7-4&from=paste&height=745&id=u2ea0212d&originHeight=1118&originWidth=1990&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1316939&status=done&style=none&taskId=ubb8316d8-9875-47be-bf31-b8e43f8dec3&title=&width=1326.6666666666667)
这里先给 MQ 寄存器里的最低位上 1，先试一下能否为 1，如果进行减法运算后，被除数的符号位为 1，说明 被除数余数 - 除数为负数，被除数余数是小于除数的，说明这一位的商不能为 1，应该为零，那么，就给这一位置 0，然后被除数再加上除数，达到恢复原来的状态。
然后逻辑左移，低位补 0。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703331323132-d51e3865-26c4-45b9-9eba-aa88dfa01fcf.png#averageHue=%23e5e2b3&clientId=u6039d051-90c7-4&from=paste&height=743&id=ua77654a4&originHeight=1114&originWidth=1998&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1261321&status=done&style=none&taskId=u77129b73-f8e9-4052-a984-89c267236dd&title=&width=1332)
这里确定结束的方式是，根据机器字长来确定的。[ 会不会有除尽的后停止的方式？ ]
机器字长为 5 位，那么只需要进行 5 次运算即可。

恢复余数的方式比较繁琐，可以进行简化。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703331874832-6f3a8bb5-7aef-428e-a6d4-49ceb2fa09ca.png#averageHue=%23e7e0d5&clientId=u6039d051-90c7-4&from=paste&height=734&id=u8e4bb12d&originHeight=1101&originWidth=1988&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1415706&status=done&style=none&taskId=u8894e5df-6cb3-47b2-8ed3-047bf63c2ad&title=&width=1325.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703331885361-57b0c5ff-5ec5-439d-b00f-98cbe78d9a0b.png#averageHue=%23e8e6dd&clientId=u6039d051-90c7-4&from=paste&height=455&id=u4a7df0b7&originHeight=683&originWidth=1510&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=780041&status=done&style=none&taskId=u390d99e0-b535-4cd4-b01c-57c043ad46c&title=&width=1006.6666666666666)
### 加减交替法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703331918953-3ea69a7b-3da1-4eb9-927c-6be4ac849968.png#averageHue=%23e3ded2&clientId=u6039d051-90c7-4&from=paste&height=747&id=u3dad2e9d&originHeight=1120&originWidth=1999&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1836574&status=done&style=none&taskId=u75dfac1d-a93c-48ae-954e-1ebce2f3e02&title=&width=1332.6666666666667)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703331936563-051484d7-f6f3-4c72-97de-2598a4830239.png#averageHue=%23e7e2d8&clientId=u6039d051-90c7-4&from=paste&height=737&id=u53b2b457&originHeight=1105&originWidth=1973&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1390010&status=done&style=none&taskId=u0127f050-a51d-4671-bbff-b983deed03e&title=&width=1315.3333333333333)
再最后一步时，如果被除数为负数，加减交替法同样需要恢复余数，加上除数。【可能的情况】
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703332010037-4e357c72-b716-4cce-ad92-bfb0abc3501b.png#averageHue=%23e1e6ef&clientId=u6039d051-90c7-4&from=paste&height=207&id=u2ff534b8&originHeight=311&originWidth=1537&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=420779&status=done&style=none&taskId=u4eab6ac7-cb81-4c70-a79f-6ddab54750f&title=&width=1024.6666666666667)
问题：这里是定点小数的运算，如果被除数小于除数呢？
比如 0.011 / 0.111，这会让商大于 1，而定点小数无法表示大于 1 的数，这个 bug 会由硬件电路去检测，如果第一个商为 1，那么会直接停止除法运算。
### 补码的除法运算


## 2.2.8 强制类型转换

## 2.2.9 数据的存储和排列
### 大小端模式



## 2.3.1 浮点数的表示
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704120379939-06f63577-0f07-4e98-a7e9-c8ca858418aa.png#averageHue=%23f3f3f3&clientId=ud487d7bb-849f-4&from=paste&height=197&id=uc98bd8c2&originHeight=295&originWidth=1271&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27188&status=done&style=none&taskId=u661da250-ee50-490d-8a20-0a7bdc0f6fa&title=&width=847.3333333333334)
阶码反应数值大小，尾数反应数值精度。





## 2.3.2 IEEE 754

## 2.3.3 浮点数的运算



# 第三章 存储系统
## 3.0 据说是本章重点
### 1.存储器的功能，分类，存储系统的层次结构
### 2.主存储器的技术指标：存取时间、存储周期、带宽
### 3.SRAM 的存储原理
### 4.DRAM 的存储原理
### 5.动态存储器 DRAM 的刷新
刷新的定义
刷新周期的定义
刷新的方法以及常用的刷新方式（集中刷新、分散刷新、异步刷新）
### 6.【重点】存储器与 CPU 的连接方法，存储器容量的扩充：位扩展法、字扩展法、字位同时扩展法
### 7.【重点】半导体存储器的逻辑设计
主要考虑芯片的选用，存储空间的安排，地址分配与片选逻辑式，或用译码器实现片选，信号线的连接即画出存储器的逻辑框图。
### 8.奇偶校验码
### 9.只读存储器和闪存的基本原理
### 10.双端口存储器
工作原理、逻辑结构。
无 \ 有冲突的读写控制。
冲突。
### 11.多模块存储器
多模块顺序存储器和交叉存储器带宽的计算。
工作原理、基本结构、存取方式。
### 12.cache 的功能
cache 命中率 h 的计算 、cache 主存存储系统的访问效率 e 和平均访问时间 ta。
cache 替换策略。
### 13.cache 映射
三种映射方式，主存地址格式，cache 地址格式，映射图画法。
### 14.磁表面存储器的读写原理
### 15.磁盘上信息的分布，磁道、扇区
### 16.磁盘存储器的技术指标
存储密度、存储容量、平均存取时间、数据传输率

## 3.1 存储系统概览
存储器的层次、分类、性能指标。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703335998427-cbb140fe-5c21-466e-864a-b1005f75339b.png#averageHue=%23f6f5f5&clientId=u6039d051-90c7-4&from=paste&height=599&id=ub311972f&originHeight=898&originWidth=1593&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=882457&status=done&style=none&taskId=uaee77d35-4976-4470-9a17-c2e605b1774&title=&width=1062)
寄存器——Cache——主存【内存】——硬盘【辅存】——磁带、光盘等【外村】。


## 3.2.1 主存储器的基本组成

## 3.2.2 SRAM 和 DRAM
DRAM 和 SRAM
DRAM 通常用于主存，SRAM 用于 cache。
DRAM 用栅极电容存储信息，SRAM 用双稳态触发器存储信息。
### DRAM 栅极电容
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703345332132-a3ccab02-a895-4dc6-816a-61eb33af4b85.png#averageHue=%23f6f4f4&clientId=u6039d051-90c7-4&from=paste&height=686&id=ua6dd626d&originHeight=1029&originWidth=1210&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=375692&status=done&style=none&taskId=uaf0d5105-a9aa-4778-a7d5-57d3f7c5be1&title=&width=806.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703345352484-c78dfc4c-d44e-4e90-a120-a5a083527a86.png#averageHue=%23688c76&clientId=u6039d051-90c7-4&from=paste&height=406&id=u6ac08e22&originHeight=609&originWidth=840&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=490689&status=done&style=none&taskId=u81db51ae-416c-4c06-ba3b-c4dcf7163a8&title=&width=560)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703345945602-45686382-9fcb-4c56-a973-63275e217c7b.png#averageHue=%23fefbfb&clientId=u6039d051-90c7-4&from=paste&height=359&id=ua1640167&originHeight=538&originWidth=632&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=90423&status=done&style=none&taskId=ud9fe57dc-e36e-48d2-82eb-7696ab76a77&title=&width=421.3333333333333)
这里就不详细讲解如何存储 0/1 信息了。
字选择线和数据线同时导通，数据线通 5v 电压时，向电容充电。
字选择线和数据线同时导通，数据线通 0v 低电平信号时，电容放电，若为 1，说明电容存储了电荷，为 0，说明电容没有存储电荷。
### SRAM 双稳态触发器
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346302164-ec5b709d-fe2f-4323-8f1a-66aca32708a5.png#averageHue=%23f9f8f8&clientId=u6039d051-90c7-4&from=paste&height=769&id=u0f1d7370&originHeight=1154&originWidth=1724&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=60816&status=done&style=none&taskId=u98777ee0-95d6-47da-b3d4-9ca3dc12219&title=&width=1149.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346357008-acd883b1-66f9-48b9-9150-d581126009ba.png#averageHue=%23f6f5f4&clientId=u6039d051-90c7-4&from=paste&height=445&id=u525e53fb&originHeight=667&originWidth=707&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=256000&status=done&style=none&taskId=u58ba0a36-9d40-4583-b90f-c1c07175761&title=&width=471.3333333333333)
### 读写区别
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346434458-d6e2263c-09ff-4566-af18-174f5114db5a.png#averageHue=%23f8f4ee&clientId=u6039d051-90c7-4&from=paste&height=865&id=u5a245b90&originHeight=1297&originWidth=2255&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1579993&status=done&style=none&taskId=u37896bfd-c272-4db9-a6cf-45af1be1949&title=&width=1503.3333333333333)
DRAM 需要重新写入，SRAM 不需要。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346689447-89a1c964-2141-414f-80b0-ca5fe2395837.png#averageHue=%23f7ece9&clientId=u6039d051-90c7-4&from=paste&height=549&id=u8d492716&originHeight=823&originWidth=1322&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=642554&status=done&style=none&taskId=ue57cfd80-c74a-48a5-9ed3-7cceeb8d54b&title=&width=881.3333333333334)
### DRAM 刷新
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346724401-0e966be0-db76-4242-9a84-0c48117e4a47.png#averageHue=%23fefbfa&clientId=u6039d051-90c7-4&from=paste&height=349&id=u63e52de3&originHeight=523&originWidth=630&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=91649&status=done&style=none&taskId=ub9c0249b-decb-46fb-ba4c-16f8b7a7f4e&title=&width=420)
电容中的电荷只能存储 2ms，即使不断电，也要在 2ms 内刷新电容中的电荷。而 SRAM 的双稳态触发器就不需要刷新，只要一直供电，就可以一直维持着保存的信息。

如何给 DRAM 刷新。
1.多久刷新一次？大概以 2ms 为一次周期。
2.每次刷新多少存储单元？以行为单位，每次刷新一行存储单元。
3.如何刷新？有硬件支持，读出一行信息后重新写入，占用 1 个读写周期。
4.什么时候刷新？
三种刷新方式：分散刷新，集中刷新，异步刷新。

这里补充一下行列地址。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703346997521-b4356f9c-daae-4e9c-bf09-5f5262ef1e74.png#averageHue=%23f5f5f5&clientId=u6039d051-90c7-4&from=paste&height=491&id=u5f85d40e&originHeight=737&originWidth=786&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=106583&status=done&style=none&taskId=u99cb36df-52fa-41a5-9789-b22d36fe8da&title=&width=524)
如果有 1M 存储单元，220 的选通线集成在译码器上是比较困难的，1048576 的数据线。如果二维地排列存储单元，则用两个译码器表示行和列，就能使每个译码器只需要集成 1024 根线，也就是 210 的线就够了。![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703347398204-b949ca4c-63d9-4e06-8cfc-53b018174afa.png#averageHue=%23f7f4f4&clientId=ue50e32e8-3f06-4&from=paste&height=531&id=u9e45c32a&originHeight=796&originWidth=1382&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=248571&status=done&style=none&taskId=ua1072222-9b5e-472f-9d35-e95032e78c4&title=&width=921.3333333333334)
### 
## 3.2.3 ROM 只读存储器
RAM 芯片有易失性，ROM 没有，断电后数据不会消失。

## 3.2.4 双端口 RAM & 多模块存储器
早期计算机是以 CPU 为中心的，计算机内部各个部件之间的信息传输都受到了 CPU 的控制。IO 设备与主存之间的信息交换也经过了 CPU 的运算器。这种结构严重影响了 CPU 的效能发挥，所以，逐渐演变成了以内存为主的计算机系统。
### 存储周期的概念
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703401151110-4b89a109-37a1-490a-a15b-a09a3e44f0dd.png#averageHue=%23f6f5f5&clientId=ud19d15dc-fa9c-4&from=paste&height=350&id=uee86b3ed&originHeight=525&originWidth=1198&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=181959&status=done&style=none&taskId=uad6a1b5c-f01f-4e72-b79e-7348715c09c&title=&width=798.6666666666666)

DRAM 的恢复时间很长，有可能是存取时间的好几倍。而 SRAM 的恢复时间比较短。

问题引入：
传统的计算机在任一时刻只能进行一次读写操作，不能被多个部件同时访问。
多核 CPU 都要访存。双口 RAM
CPU 的读写速度很快，而主存的恢复时间过长。多模块存储器
### 双端口 RAM
双端口 RAM 可以优化多个 CPU 访问一根内存条的速度。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703403133793-da8ad1ef-1675-4de2-b7fe-0139dc86a081.png#averageHue=%23ededed&clientId=ud19d15dc-fa9c-4&from=paste&height=556&id=ubd55b6e8&originHeight=834&originWidth=1209&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159358&status=done&style=none&taskId=u9c1663e6-1d6e-42b7-9742-297ca749251&title=&width=806)
这是双口 RAM 的简单模型图，RAM 有两组完全独立的控制线，地址线，数据线来对 RAM 进行读写操作。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703403183721-078ad93b-cfdc-4787-8ce0-65d7d48ddd3d.png#averageHue=%23e6e4e4&clientId=ud19d15dc-fa9c-4&from=paste&height=180&id=udd6d23cf&originHeight=270&originWidth=1559&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=261836&status=done&style=none&taskId=u68b72844-b569-45c8-9b3a-a0563f42a22&title=&width=1039.3333333333333)
如何解决错误发生？
可以对 RAM 添加一个【忙】信号，由逻辑判断暂时关闭某一个端口，即一个端口被延时操作。未被关闭的端口可以正常访问。被关闭的端口延长一个很短的时间后再访问。
也就是设计了 BUSY 信号。
这里在书中 P87 有详细解释。
### 多体并行存储器
多体并行存储的方式可以解决单个 CPU 访问主存，主存因为有恢复时间导致速度不匹配的问题。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405467265-8cead5af-1e8a-4189-ba5a-5dec7677fdf8.png#averageHue=%23fefefe&clientId=ud19d15dc-fa9c-4&from=paste&height=451&id=uad33fcca&originHeight=676&originWidth=1091&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=94717&status=done&style=none&taskId=ud0d278e8-548a-47c4-b945-b9bdda458fc&title=&width=727.3333333333334)
体号 | 体内地址 —— 高位交叉编址的多体存储器
体内地址 | 体号 —— 低位交叉编制的多体存储器
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405595221-04f871d0-0f5e-4d6a-9971-dc21a4428f50.png#averageHue=%23dedbcf&clientId=ud19d15dc-fa9c-4&from=paste&height=385&id=ua5474216&originHeight=577&originWidth=1414&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=792565&status=done&style=none&taskId=u1a2ce176-8a5f-4ea2-b920-644117f264b&title=&width=942.6666666666666)
每个存储体的存取周期为 T
存取时间为 r
T = 4r
则有恢复时间为 3r
用高位交叉编址，也就是顺序方式读取主存数据的话。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405734657-c2b72d28-7141-44a4-9ea3-81311569788e.png#averageHue=%23e4e2db&clientId=ud19d15dc-fa9c-4&from=paste&height=395&id=uf1fe81f8&originHeight=239&originWidth=741&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=135017&status=done&style=none&taskId=u14b8d652-5af3-4b8c-ad26-a56a26c7a36&title=&width=1226)
花费的时间是这样的。
如果用交叉方式，低位交叉编址的话。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405783613-33c71b96-31d8-4ad5-a142-81c12f0ca547.png#averageHue=%23bcd4a9&clientId=ud19d15dc-fa9c-4&from=paste&height=609&id=ud81a9574&originHeight=344&originWidth=692&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=270179&status=done&style=none&taskId=u9071e8c9-986e-4c78-8a43-4958b133b5e&title=&width=1225.3333435058594)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405858039-1cb9748e-fd33-404b-b323-ec9e77e35ce2.png#averageHue=%23fcfbfb&clientId=ud19d15dc-fa9c-4&from=paste&height=789&id=ud50718cb&originHeight=1183&originWidth=1464&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=286587&status=done&style=none&taskId=u44448821-846d-4402-9af4-a9668f8adfb&title=&width=976)
花费的时间为 T+【n-1】r 的时间。
n 为读取的存储字个数。


![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703406510664-c4563372-9736-4a73-a477-b3b5d4349da8.png#averageHue=%23c4d4ae&clientId=ud19d15dc-fa9c-4&from=paste&height=603&id=uac2e6cb9&originHeight=904&originWidth=1602&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1282615&status=done&style=none&taskId=ub341e458-070c-4b19-9de0-3275e701a6c&title=&width=1068)
这个问题中的 mmin 就是课本中提到的交叉存取度。
让 m = T/r 是最效率做法。
### 题目
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703405942156-98dc3261-7494-47c2-aa85-fc91542e5c62.png#averageHue=%23f9f8f6&clientId=ud19d15dc-fa9c-4&from=paste&height=393&id=uf6b6e1ef&originHeight=589&originWidth=1389&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=166499&status=done&style=none&taskId=u772baf3f-b72b-4a1a-a568-f56a3a7ff70&title=&width=926)
![](https://cdn.nlark.com/yuque/0/2023/jpeg/33668709/1703406254480-877ff4ec-f897-4ee8-abff-c9e1e1388094.jpeg)

### 单体多字存储器
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703407287686-0ae5bf0a-35e1-4577-b9b4-3353c6d74382.png#averageHue=%23f6f6f5&clientId=ud19d15dc-fa9c-4&from=paste&height=478&id=u8fa1c82e&originHeight=717&originWidth=1304&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=525278&status=done&style=none&taskId=udad81d8c-cf4a-479d-a64a-398c9922d91&title=&width=869.3333333333334)
单体多字存储器不是重点，这个应该已经弃用了。
### 总结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703407358462-9234420e-7ab6-4fee-a525-080e94106313.png#averageHue=%23f1f1f1&clientId=ud19d15dc-fa9c-4&from=paste&height=693&id=u84bb861f&originHeight=1040&originWidth=2174&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=683785&status=done&style=none&taskId=uda206777-ad30-460c-b6ba-ed9e209e61d&title=&width=1449.3333333333333)

## 3.2.1 CPU 与主存的连接
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703407542891-271f5959-aa52-4ffc-baa0-3f9dcbd38dc8.png#averageHue=%23f9f9f9&clientId=ud19d15dc-fa9c-4&from=paste&height=453&id=uf77a4bc7&originHeight=680&originWidth=2087&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=246756&status=done&style=none&taskId=u018d5104-adcc-44e7-9ed8-f93dadd1bd0&title=&width=1391.3333333333333)
### 单块存储芯片与 CPU 的连接
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413293461-61f7521a-a80d-4a79-a8b3-f69bae8e4b18.png#averageHue=%23f2e0e0&clientId=ud19d15dc-fa9c-4&from=paste&height=889&id=u3349dc14&originHeight=1333&originWidth=2376&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1160592&status=done&style=none&taskId=uffd7a73d-d029-4d66-9969-a92a62ecda5&title=&width=1584)
MDR 和 MAR 集成在 CPU 中，而不是在存储芯片里。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413544390-4a68b668-60b1-42a1-9eaa-f171c2da14c8.png#averageHue=%23f8f8f8&clientId=ud19d15dc-fa9c-4&from=paste&height=425&id=u64086869&originHeight=637&originWidth=1119&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=114418&status=done&style=none&taskId=u3b0466f1-f660-49f7-b821-cc9cc3e55e2&title=&width=746)


要满足数据总线宽度 = 存储芯片字长。
数据总线宽度 > 存储芯片字长 —— 位扩展。
扩展主存字数 —— 字扩展。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413671753-38659b32-38f7-4699-8ab3-54406863a7b1.png#averageHue=%23f4eaea&clientId=ud19d15dc-fa9c-4&from=paste&height=451&id=ua0bf1181&originHeight=676&originWidth=2021&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=353219&status=done&style=none&taskId=ua474e050-6493-4bc0-84ab-0002969a52b&title=&width=1347.3333333333333)

### 多块存储芯片与 CPU 的连接
#### 位扩展法
给定的芯片的字数(地指数)符合要求，但位数较短，不满足设计要求的存储器字长， 则需要进行位扩展，让多片给定芯片并行工作。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413822638-5c724b00-e9ad-473d-8d01-8cb96b191bcd.png#averageHue=%23fcfbfa&clientId=ud19d15dc-fa9c-4&from=paste&height=665&id=u3ef15a22&originHeight=997&originWidth=1736&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=217704&status=done&style=none&taskId=ub7a0dad5-c607-44ad-8a62-9c2a1e18ba7&title=&width=1157.3333333333333)
初始时拥有 8K × 1 位的芯片，数据总线利用的不充分，数据总线带宽 > 存储芯片位数，可以通过把存储芯片串联起来的方式扩展位数。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413928984-0cc5520c-97ba-4686-b464-4a85efc41c0b.png#averageHue=%23f0ebeb&clientId=ud19d15dc-fa9c-4&from=paste&height=410&id=u623e1dfe&originHeight=615&originWidth=1099&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=96962&status=done&style=none&taskId=u668241bf-f633-4927-b66a-38adb52a158&title=&width=732.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703413993516-1b2c79dd-fd6f-40eb-96d9-361f0df06bf8.png#averageHue=%23fefefe&clientId=ud19d15dc-fa9c-4&from=paste&height=435&id=u3dad73d4&originHeight=652&originWidth=1191&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=66403&status=done&style=none&taskId=ua09596e1-0115-4884-8c5c-1ddd72b539f&title=&width=794)
连接的三组信号线中，地址线、控制线公用，数据线分高 4 位、低 4 位，分别与两片 SRAM 芯片的 I/O 端相连接，两片同时工作。

#### 字扩展法
##### 线选法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415067068-875b1546-3602-4509-b6e8-3e72549156e8.png#averageHue=%23f5efef&clientId=ud19d15dc-fa9c-4&from=paste&height=387&id=ue20cd753&originHeight=581&originWidth=1131&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=135326&status=done&style=none&taskId=u9e004594-2a0f-4162-a6f1-9a96c3230b6&title=&width=754)
##### 片选法
可以给上图的 A13 A14 A15 添加一个 3-8 译码器，然后增添 7 片芯片来扩充字数。也就是从 8KB 变为了 8×8KB = 64KB。这个方法是片选法。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415206233-5a912f3a-2f52-4968-adac-8d8e1367ed21.png#averageHue=%23f5efee&clientId=ud19d15dc-fa9c-4&from=paste&height=393&id=u3c1146bc&originHeight=589&originWidth=1108&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=127547&status=done&style=none&taskId=u423b3672-b28d-4041-9362-5cab83bd5c9&title=&width=738.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415247616-d9e9b426-e88d-4d4b-bdf5-0396136ede63.png#averageHue=%23fefefe&clientId=ud19d15dc-fa9c-4&from=paste&height=705&id=u10443d74&originHeight=584&originWidth=1022&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=48623&status=done&style=none&taskId=ub8ca8ad2-093a-4476-8d3d-e00baf10ee5&title=&width=1233.3333740234375)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415341667-d231a47c-7bb1-44bf-b730-ec2813ce148a.png#averageHue=%23f5f1f1&clientId=ud19d15dc-fa9c-4&from=paste&height=502&id=u708eb5c8&originHeight=571&originWidth=1114&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=127241&status=done&style=none&taskId=u5bd3b76c-fc70-4e1d-bd97-11b8de5c642&title=&width=978.6666870117188)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415365255-79858264-4008-4862-9cec-64086c865416.png#averageHue=%23b7cce3&clientId=ud19d15dc-fa9c-4&from=paste&height=127&id=u89ebb206&originHeight=191&originWidth=1081&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=75556&status=done&style=none&taskId=uc5ff59e8-1abc-454d-84cf-e1f4b950d26&title=&width=720.6666666666666)

#### 字位扩展法
若给定的芯片位数和字数都不符合存储要求，那么先扩展位数，再扩展字数。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415480358-fc554ee0-8cc1-4070-8377-f87f7a1d282d.png#averageHue=%23f5f0f0&clientId=ud19d15dc-fa9c-4&from=paste&height=687&id=u12f5be80&originHeight=1031&originWidth=1968&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=494147&status=done&style=none&taskId=u7b777d3c-3591-4b9e-8256-4486cb4f5bc&title=&width=1312)
### 关于译码器的补充
数电学过了。
## 3.4.1 磁盘存储器
这里从内存走到了外存。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703415535216-ae2f2504-675c-4104-b2d9-3fdfe9cac602.png#averageHue=%235b5a57&clientId=ud19d15dc-fa9c-4&from=paste&height=259&id=uba3dba68&originHeight=388&originWidth=1869&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=168606&status=done&style=none&taskId=u202c73e8-360f-4374-8022-8c60746beb7&title=&width=1246)
### 磁表面存储器的读写原理
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121338210-d63932ae-695a-4186-a0c7-9124feded862.png#averageHue=%23e7e7e7&clientId=ud487d7bb-849f-4&from=paste&height=413&id=u5a4ce033&originHeight=619&originWidth=1156&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=337206&status=done&style=none&taskId=ud5ec3c36-55db-4979-bf02-37f900fa4e1&title=&width=770.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121371185-2277d228-d0e6-48ff-afde-a84cc2459c0d.png#averageHue=%23e9dff4&clientId=ud487d7bb-849f-4&from=paste&height=723&id=u691e0989&originHeight=1084&originWidth=1660&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=284337&status=done&style=none&taskId=ue85c1d8a-33c6-40ae-b75c-303917fd583&title=&width=1106.6666666666667)
### 磁盘上信息的分布
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121598792-bb68596c-38ff-4b38-bd84-fc199c14b17a.png#averageHue=%23f5f4f2&clientId=ud487d7bb-849f-4&from=paste&height=545&id=u2b339431&originHeight=818&originWidth=1130&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=359358&status=done&style=none&taskId=u9a168af3-9043-41b0-be97-8871d143410&title=&width=753.3333333333334)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121687630-ec104cf2-bf68-47b9-bdc7-f0fe112adca2.png#averageHue=%23ebe9e2&clientId=ud487d7bb-849f-4&from=paste&height=476&id=ua598419d&originHeight=714&originWidth=1685&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=489176&status=done&style=none&taskId=u68f65d1d-bbf4-4571-a256-3c4b71c7627&title=&width=1123.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121695598-6a3c34f1-5f0f-4648-87b3-2ac8f1b01094.png#averageHue=%23e1e1e1&clientId=ud487d7bb-849f-4&from=paste&height=344&id=ucb78d2e3&originHeight=516&originWidth=757&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=125584&status=done&style=none&taskId=uc9e3fe03-69d7-41ee-b004-db41dff5a69&title=&width=504.6666666666667)
### 磁盘上信息的记录方式
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121753430-4210153d-57b2-4046-86aa-ae503f781089.png#averageHue=%23e8e1fb&clientId=ud487d7bb-849f-4&from=paste&height=673&id=u4d40eb3c&originHeight=1009&originWidth=1504&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=281598&status=done&style=none&taskId=u77134a9e-b874-4393-9a2a-420a1190d1c&title=&width=1002.6666666666666)

### 磁盘的性能指标【重点】

1. 存储容量
一个磁盘存储器能存储的字节总数。以 B 为单位。
有格式化容量和非格式化容量之分。
非格式化容量：磁记录表面可以利用的磁化单元总数。
格式化容量：按照某种特殊的记录格式所能存储信息的总量。
这两个概念有点模糊。
2. 存储密度
道密度：
磁盘半径上单位长度的磁道数。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704123267494-274cf29d-f077-4885-968a-d4059fcd51cc.png#averageHue=%23fcfaf5&clientId=ud487d7bb-849f-4&from=paste&height=202&id=u3d35b69f&originHeight=514&originWidth=1150&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=280360&status=done&style=none&taskId=u175901da-936b-418a-8769-0f26b74ef88&title=&width=453)
位密度：
磁道上单位长度更记录的信息位数 [ 二进制代码位数 ]。bits。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704123353986-9b1b04ac-8dff-4c0d-b0df-830e8f65dfec.png#averageHue=%23efe4ce&clientId=ud487d7bb-849f-4&from=paste&height=255&id=uab9a9818&originHeight=382&originWidth=1563&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=417408&status=done&style=none&taskId=uddafe770-8bee-4bf0-a536-4497d0313bf&title=&width=1042)
注意，每个磁道的位密度不一样，靠内侧的磁道位密度更大，因为每个磁道都有记录相同位数的信息。
面密度：
位密度 × 道密度 = 面密度。
3. 平均存取时间
平均时间 = 寻道时间（找到需要写入或读取的磁道扇区）+ 旋转延迟时间（磁头定位到目的扇区）+ 传输时间（传输数据花费的时间）。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704123881336-913fd970-f0b7-4878-aed5-fe4ee17811dc.png#averageHue=%23f9f6f3&clientId=u059706ea-c4ad-4&from=paste&height=581&id=u5b0915e9&originHeight=872&originWidth=1491&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=207326&status=done&style=none&taskId=u8a97cae2-283f-4b8e-96cd-8dfffd2afba&title=&width=994)
4. 数据传输率
磁盘存储器在单位时间内向主机传送数据的字节数。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704123915396-916f9e18-e889-426e-9002-bf1084c49223.png#averageHue=%23fefefe&clientId=u059706ea-c4ad-4&from=paste&height=441&id=u71f93ce0&originHeight=661&originWidth=1414&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=166496&status=done&style=none&taskId=u26d7e091-bd94-42e8-9cdf-65d3f9c2717&title=&width=942.6666666666666)
### 例题

![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124063369-518c7fbe-c91d-4ee6-83a5-4d3dadf2e6f8.png#averageHue=%23f3f3f3&clientId=u059706ea-c4ad-4&from=paste&height=637&id=ued5b78a6&originHeight=955&originWidth=1522&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=239824&status=done&style=none&taskId=u5352f193-901b-412e-830a-3fb6bf552bd&title=&width=1014.6666666666666)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124070800-daf6d537-0394-457b-88a6-296d16965093.png#averageHue=%23f3f3f3&clientId=u059706ea-c4ad-4&from=paste&height=691&id=ube5fb88c&originHeight=1036&originWidth=1523&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=288847&status=done&style=none&taskId=u257e4c31-41aa-4b03-b7a3-bf9f723f20e&title=&width=1015.3333333333334)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124077122-e1834681-db8e-426b-8c4a-f4fa9f076757.png#averageHue=%23f4f4f4&clientId=u059706ea-c4ad-4&from=paste&height=641&id=ub0ecfce9&originHeight=961&originWidth=1516&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=240696&status=done&style=none&taskId=u8728cbae-6d44-4742-8fb8-c4046652c76&title=&width=1010.6666666666666)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124087415-c5c73dce-6cc3-4665-aed7-0792322f22c6.png#averageHue=%23f2eeed&clientId=u059706ea-c4ad-4&from=paste&height=659&id=uac12b79d&originHeight=988&originWidth=1545&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=307496&status=done&style=none&taskId=ua2bd565d-8fda-4ddf-88f6-32a3a3b68cf&title=&width=1030)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124095793-42326759-62c1-43ce-bc17-57fddb5e9088.png#averageHue=%23e6ddf3&clientId=u059706ea-c4ad-4&from=paste&height=695&id=uf899bb4c&originHeight=1043&originWidth=1499&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=336216&status=done&style=none&taskId=u294f9443-340a-41df-8fa0-7416eef6dbb&title=&width=999.3333333333334)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124101932-b9de332a-35c1-4d0b-96c5-2b52a3e613d3.png#averageHue=%23f4f4f4&clientId=u059706ea-c4ad-4&from=paste&height=689&id=u637bc043&originHeight=1033&originWidth=1484&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=272868&status=done&style=none&taskId=u0e93e57b-ec85-43ce-9c86-f7a6ea02ffc&title=&width=989.3333333333334)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124108579-92e5f463-0b83-4ab7-b30e-b82521a3e34c.png#averageHue=%23f4f4f4&clientId=u059706ea-c4ad-4&from=paste&height=719&id=u45fe355a&originHeight=1079&originWidth=1527&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=290413&status=done&style=none&taskId=uaca84df3-ab63-46b8-ab32-1b44d754149&title=&width=1018)![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124115327-cff7f836-e9f7-468a-81a7-ebe56ad0270e.png#averageHue=%23f3f3f3&clientId=u059706ea-c4ad-4&from=paste&height=721&id=uf6996b05&originHeight=1081&originWidth=1553&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=340075&status=done&style=none&taskId=u5febe3ee-db10-4bb8-b661-78f58d13b36&title=&width=1035.3333333333333)









## 3.4.2 SSD 固态硬盘

## 3.5.1 cache
双端口 RAM 和多模块存储器提高存储器的工作速度，但是和 CPU 的速度仍然不太匹配。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703416611290-807ad0a0-c44a-486d-bbae-bd91bb84de84.png#averageHue=%23faf9f8&clientId=ud19d15dc-fa9c-4&from=paste&height=551&id=ub9f4a0c8&originHeight=827&originWidth=1353&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=225351&status=done&style=none&taskId=u6a1ca1ac-07ae-4a07-bbd6-4edea1c71da&title=&width=902)
集成在 CPU 中。
由于访问数据具有时间局部性和空间局部性。
目前正在访问的地址【相关联】的数据会被放在 cache 中。


cache 除了要有 SRAM 外，还要有控制逻辑。若 cache 在 CPU 外，那么控制逻辑一般与主存的控制逻辑合在一起，如果在 CPU 内部，则由 CPU 提供 cache 的控制逻辑。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703417058463-ed9f9b85-b2cf-4a76-ac78-a992c0338b23.png#averageHue=%23fefefe&clientId=ud19d15dc-fa9c-4&from=paste&height=898&id=u949fa35d&originHeight=553&originWidth=637&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=40641&status=done&style=none&taskId=u5eaec60f-2f9a-43c4-8bd4-4d96ece5180&title=&width=1034.6666870117188)
### cache 命中
cache 与 CPU 的数据交换以字为单位。而 cache 与主存之间的数据交换以块为单位【块是一定数目的字，定长】。
当 CPU 读取内存 中一个字时，便发出此字的内存地址到 cache 和主 存。此时cache 控制逻辑依据地址判断此字当前是否在cache 中：若是，则cache 命中，此字立即传送给CPU；若非，则cache 缺失(未命中)，用主存读周期把此字从主存读出送到CPU，与此同时，把含有这个字的整个数据块从主存读出送到cache 中。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703417220398-7641fa7f-8b20-4337-aa5f-f3104b7d9f2a.png#averageHue=%23ededed&clientId=ud19d15dc-fa9c-4&from=paste&height=371&id=u6a90f02f&originHeight=556&originWidth=1097&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=128047&status=done&style=none&taskId=u92b2c6dd-6b20-4606-a617-d62d67f1492&title=&width=731.3333333333334)
有两种读数据的方式。
一种是先去 cache 中查找数据，如果没查找到再去主存中查找。
一种是同时在 cache 和主存中查找。
### 题目 [ 命中 ]
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703417890898-2045be92-9cc9-4b9d-b86a-2d1dc0e987ae.png#averageHue=%23fcfcfb&clientId=ud19d15dc-fa9c-4&from=paste&height=661&id=ub7d29e4e&originHeight=992&originWidth=1345&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=116415&status=done&style=none&taskId=ufc373f64-2aa2-411a-afb9-e42a06ab4b2&title=&width=896.6666666666666)
### 块
前面提到过，cache 和 CPU 的数据交换是以字为单位的，而 cache 和主存之间的交换是以块为单位的，块是定长的，是一定数目的字。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703417980698-62a2cbfc-eaf0-48d6-873b-e6276496ec0d.png#averageHue=%23f2f1eb&clientId=ud19d15dc-fa9c-4&from=paste&height=695&id=u15d0752a&originHeight=1043&originWidth=2161&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=652994&status=done&style=none&taskId=u7a375638-7097-4947-8527-1fde13cfff0&title=&width=1440.6666666666667)
如果没有在 cache 中访问到需要的数据，会去主存中寻找，在主存中寻找的数据所在的块会被放在 cache 中。
### 问题引入
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703418235518-ec68f8d1-ced7-4f9b-b7f8-4e0d1ea72985.png#averageHue=%23f2f0ef&clientId=ud19d15dc-fa9c-4&from=paste&height=535&id=hHeTM&originHeight=802&originWidth=1144&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=207966&status=done&style=none&taskId=uf5445bc6-6dc6-4477-bf81-04d7389603d&title=&width=762.6666666666666)

1. 如何区分 cache 块号和主存块号的对应关系？主存的内容如何存放在 cache 中？访存时如何找到 cache 中的信息？——地址映射
2. cache 空间不足时如何替换已有的内容？——替换算法
3. CPU 修改数据是修改的 cache 中的数据，如何保证 cache 中的数据和主存中的数据是一致的？[ 数据副本和数据母本的数据的一致性 ]——cache 写策略

### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703418524541-e576c588-b814-45dc-b097-8c4fc9533853.png#averageHue=%23efefeb&clientId=ud19d15dc-fa9c-4&from=paste&height=774&id=u3acb058c&originHeight=1161&originWidth=2375&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=899513&status=done&style=none&taskId=u3a4c90a8-31c0-4ec4-9d09-ae02730bdcb&title=&width=1583.3333333333333)
## 3.5.2 cache 地址映射
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703418635510-e5a38965-e734-44d4-a1cc-347faa6d1086.png#averageHue=%23efefef&clientId=ud19d15dc-fa9c-4&from=paste&height=543&id=ubacf4012&originHeight=815&originWidth=1898&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=371499&status=done&style=none&taskId=u86be8b98-a668-488c-8ff4-293967662ed&title=&width=1265.3333333333333)
三种映射方式。

1. 全相联映射：主存块可以存放在 cache 的任意位置。
2. 直接映射：每个主存块只能放在一个特定的位置。cache 块号 = 主存块号 % cache 总块数。
3. 组相联映射：cache 块号分为若干组，主存存放在特定分组中。组号 = 主存块 % 分组数。
### 全相联映射
### ![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703419449421-f567e63e-ffea-4d55-b66d-f03382a356a0.png#averageHue=%23f4f3f3&clientId=ud19d15dc-fa9c-4&from=paste&height=817&id=u98dce6f2&originHeight=1226&originWidth=2293&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=948355&status=done&style=none&taskId=u6ac3566f-36e0-4b05-a557-b2cc7c883b9&title=&width=1528.6666666666667)
主存地址空间为 256MB，说明是按字节编址的。
有 256M = 28+20 = 228 个字节的数据，有 228 个地址。
cache 有 8 行，行长为 64B。
cache 行长 = 主存块大小 = 64B。
256MB 的数据，按照 64B 去分，可以分为 228 / 26 = 222 个主存块。
每个主存块有 64B 大小。
这里的 64B 包含了什么呢？包含了 64B 大小的主存存储的信息。
主存块中需要用来标记地址的位数为 22 位，用来标记块中具体某一个 B 的地址为 6 位。
 
### 直接映射
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703433281325-f946cb73-ff55-4162-9640-ae9c10003fbd.png#averageHue=%23efebe6&clientId=u6a946ed0-f203-4&from=paste&height=817&id=u12e20508&originHeight=1225&originWidth=2292&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1134927&status=done&style=none&taskId=u54674451-2138-4d79-8cc3-d4e17aa4b50&title=&width=1528)
### 组相联映射
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703433466277-4cde2d0e-b3f6-430e-854f-7c6a011d883b.png#averageHue=%23eeeae3&clientId=u6a946ed0-f203-4&from=paste&height=877&id=u89dd853a&originHeight=1316&originWidth=2327&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1212607&status=done&style=none&taskId=u4c6579ff-b4fa-4668-b50d-742ab9f5b93&title=&width=1551.3333333333333)
### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703433607474-3da26d2c-32ff-426f-b229-139ca2ffa92f.png#averageHue=%23f2f2f2&clientId=u6a946ed0-f203-4&from=paste&height=814&id=u7e92e7bc&originHeight=1221&originWidth=2141&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=759800&status=done&style=none&taskId=u7aff80c9-c7e2-4c09-a640-badc48466c4&title=&width=1427.3333333333333)
## 3.5.3 替换算法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703434326435-4b036d7c-9be6-4612-8824-70c1b29a4c9f.png#averageHue=%23f0f0f0&clientId=u6a946ed0-f203-4&from=paste&height=732&id=uf206eae0&originHeight=1098&originWidth=1960&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=587757&status=done&style=none&taskId=ud9551a53-369b-4539-b232-7f9d156cc2f&title=&width=1306.6666666666667)
有四种算法：
RAND 随机算法
FIFO 算法
LFU 算法
LRU 算法
### RAND 随机算法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703434482191-8bddade9-6608-44bb-bdfa-748f9e2612dd.png#averageHue=%23add1c0&clientId=u6a946ed0-f203-4&from=paste&height=538&id=u2ebaa666&originHeight=902&originWidth=1973&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=611697&status=done&style=none&taskId=u9c41827c-9bd5-41c2-9578-a09bf258a86&title=&width=1177)
随机算法实现简单，但是完全没有考虑局部性原理，命中率低，实际效果不稳定。

随机替换策略实际上是不要什么算法，从特定的行位置中随机地选取一行换出即可。这种策略在硬件上容易实现，且速度也比前两种策略快。缺点是随意换出的数据很可能马 上又要使用，从而降低命中率和 cache 工作效率。但这个不足随着 cache 容量增大而减小。研究表明，随机替换策略的性能只是稍逊于前两种策略。

### FIFO 算法
优先替换最先被调入 cache 的块。![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703484396651-f46e96a9-8a36-4d9b-be47-7a420d54f798.png#averageHue=%23b5cbbf&clientId=u6a946ed0-f203-4&from=paste&height=666&id=u022deaf7&originHeight=999&originWidth=1921&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=707638&status=done&style=none&taskId=u4bade4db-7204-48f1-93d4-3c7df6fbb0f&title=&width=1280.6666666666667)
队列。
FIFO 算法会有抖动现象，刚被替换出去的块接着又被替换进来。


### LFU 算法 最不经常用算法
LFU 算法认为应将一段时间内被访问次数最少的那行数据换出。为此，每行设置一个 计数器。新行调入后从 0 开始计数，每访问一次，被访行的计数器增 1。当需要替换时，对 这些特定行的计数值进行比较，将计数值最小的行换出，同时将这些特定行的计数器都清零。这种算法将计数周期限定在两次替换之间的间隔时间内，因而不能严格反映近期访问情况。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703484807610-3a332935-91d6-44d3-a009-b79d929c5035.png#averageHue=%23c8dacb&clientId=u6a946ed0-f203-4&from=paste&height=658&id=u8575e659&originHeight=987&originWidth=2002&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=725601&status=done&style=none&taskId=u255811d0-47f1-4ded-ab91-f7b224db22b&title=&width=1334.6666666666667)
计数器的值可能到达很大的数，LFU 算法并不如 LRU 算法好用。
曾经被经常访问的数据在未来可能不再访问。比如微信视频聊天的数据块计数很大，但将来都不在需要用。
### LRU 算法 近期最少使用算法
LRU 算法将近期内长久未被访问过的行换出。为此，每行也设置一个计数器，但它们 是 cache 每命中一次，命中行计数器清零，其他各行计数器增 1。当需要替换时，比较各特 定行的计数值，将计数值最大的行换出。这种算法保护了刚复制到 cache 中的新数据行，符合 cache 工作原理，因而使 cache 有较高的命中率。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703484731184-e6f7bd76-94b4-4600-b8a8-5681db2a84b1.png#averageHue=%23d3d45d&clientId=u6a946ed0-f203-4&from=paste&height=698&id=u814279af&originHeight=1047&originWidth=2274&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1127258&status=done&style=none&taskId=u176823ac-9f78-4ef4-bf1e-b3d847b4e01&title=&width=1516)
LRU 算法考虑到了局部性原理。【近期访问过的主存块，在不久的将来也很有可能再次被访问】。


## 3.5.4 cache 写策 
### 写回法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703485189828-dfb08263-065e-41a8-a46a-a197bbc5fcee.png#averageHue=%23f3efef&clientId=u6a946ed0-f203-4&from=paste&height=723&id=u574eb437&originHeight=1085&originWidth=2248&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=773094&status=done&style=none&taskId=udf9744c4-8e86-494d-b075-034da4b7709&title=&width=1498.6666666666667)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703485254112-ffd08540-3630-4661-baf6-96637e9cc6ff.png#averageHue=%23eeecea&clientId=u6a946ed0-f203-4&from=paste&height=548&id=u96faefab&originHeight=575&originWidth=1099&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=118848&status=done&style=none&taskId=u523e7eaa-9dd5-4a78-997a-102049d1c6f&title=&width=1046.6666870117188)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703485293274-10a77b77-c499-459f-b08c-77c23e7b759e.png#averageHue=%23f7f4f1&clientId=u6a946ed0-f203-4&from=paste&height=320&id=u2c34337f&originHeight=477&originWidth=1268&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=189148&status=done&style=none&taskId=ud28ad78d-38ef-4dd3-b6a0-ad1bb133eaf&title=&width=850)
### 全写法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703485412942-e802c438-fe8b-4a44-8e16-02b6b43a0f62.png#averageHue=%23f2f0ef&clientId=u6a946ed0-f203-4&from=paste&height=719&id=ud1ab5738&originHeight=1079&originWidth=2326&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=733588&status=done&style=none&taskId=ubac8e119-e63c-4f48-b7ea-d50a974aef5&title=&width=1550.6666666666667)
写缓冲的作用：
CPU 与 SRAM 制作的写缓冲信息交换速度较快，与主存之间信息交换速度慢。
缺陷：
如果 CPU 写操作比较频繁，可能会因为写缓冲饱和而发生阻塞。
写操作不频繁的话效果还算好。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703485344310-987895da-942c-486d-a391-2c15169e581d.png#averageHue=%23f8f5f3&clientId=u6a946ed0-f203-4&from=paste&height=249&id=u5f17a7f6&originHeight=374&originWidth=1286&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=129901&status=done&style=none&taskId=u6e9c7780-4224-4bbc-b9f1-80775d3bad4&title=&width=857.3333333333334)

### 写分配法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703486141804-f0ab1662-270f-47ab-b9f7-14667e815337.png#averageHue=%23f6f5f4&clientId=u6a946ed0-f203-4&from=paste&height=775&id=ue1d61498&originHeight=1163&originWidth=2321&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=751253&status=done&style=none&taskId=ua570fe86-10ee-4d7f-a3a3-a2c4efac77d&title=&width=1547.3333333333333)

### 非写分配法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703486171971-ef2a091f-18a5-406d-a35d-e7411c1d60c7.png#averageHue=%23f5f0ef&clientId=u6a946ed0-f203-4&from=paste&height=765&id=u74816c7d&originHeight=1147&originWidth=2300&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=816420&status=done&style=none&taskId=u4037d861-30b5-46c3-a151-8fd5be21a11&title=&width=1533.3333333333333)

### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703486230766-bd5630e5-58ea-4dcd-ae5c-5352830ae7d7.png#averageHue=%23eeeeee&clientId=u6a946ed0-f203-4&from=paste&height=379&id=u890b94f5&originHeight=568&originWidth=1090&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=58582&status=done&style=none&taskId=u975a1175-21ef-45dd-bce5-c37def7ed86&title=&width=726.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703486326443-3b4c78ad-25b4-4cf3-b4ef-fbf8f7517bf1.png#averageHue=%23f0efef&clientId=u6a946ed0-f203-4&from=paste&height=534&id=u88e651e0&originHeight=801&originWidth=2223&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=597115&status=done&style=none&taskId=u3ef77e57-a695-4df7-aa00-7c7dce04384&title=&width=1482)
### 多级 cache 结构
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703486260512-f82b7a00-558f-44bf-af7c-f265dac78755.png#averageHue=%23dadad8&clientId=u6a946ed0-f203-4&from=paste&height=774&id=uc1cde569&originHeight=1161&originWidth=2069&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=814216&status=done&style=none&taskId=ub8d47dce-e5e9-48e5-9794-212753ca065&title=&width=1379.3333333333333)
多级 cache 之间同样会存在数据不一致的问题，所以，他们同样会用写回法 \ 全写法来保持数据一致性。



## 3.6.1 虚拟存储器




# 第四章 指令系统
## 4.0 据说是本章重点
### 1. 指令系统的定义
一台计算机中所有指令的集合。也称指令集。
### 2.指令格式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703490099251-87eb7277-a032-443e-a523-57aaa19ef6df.png#averageHue=%23efefef&clientId=u6a946ed0-f203-4&from=paste&height=467&id=ud1898709&originHeight=701&originWidth=1540&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=267277&status=done&style=none&taskId=u9dbeb251-1751-425f-84d7-93cb52e3ca0&title=&width=1026.6666666666667)
### 3.指令字长与机器字长
半字长指令、单字长指令、双字长指令。
### 4.操作码格式
### 5.地址提供方式
几种地址结构指令。
操作码的扩展方法。
### 6.指令格式分析与设计【重点】
### 7.指令的寻址方式及程序计数器 PC 在指令寻址中的作用
### 8.操作数的寻址方式【多】
### 9.基址与变址的区别、应用


## 4.1.1 指令格式
### 引入
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703488324048-3ec7ebf3-0840-45ac-b72d-8e6575739c72.png#averageHue=%23ccc2b4&clientId=u6a946ed0-f203-4&from=paste&height=394&id=u4214529f&originHeight=639&originWidth=1705&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=479828&status=done&style=none&taskId=u84de39b3-349f-4c4f-8055-0115ae6b6b2&title=&width=1052)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703490111291-fdd4c1af-f4ad-43de-b838-f45c87554ad6.png#averageHue=%23efefef&clientId=u6a946ed0-f203-4&from=paste&height=467&id=u4e650011&originHeight=701&originWidth=1540&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=267277&status=done&style=none&taskId=u59a8811f-7886-47cf-a335-ea938ba337e&title=&width=1026.6666666666667)
x86 ARM
计算机只能执行自己指令系统中的指令，不能执行其它系统的指令。
### 格式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703490312692-8a3fe303-95c7-4687-ae68-68839150d90f.png#averageHue=%23e6f3f7&clientId=u6a946ed0-f203-4&from=paste&height=326&id=ua60e422c&originHeight=396&originWidth=1173&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=21043&status=done&style=none&taskId=u113ef7b4-78fb-4b26-bb76-f5dbe0286bb&title=&width=965)
操作码 + 地址码。
零地址指令：没有地址码，只有操作码，无操作数。
空操作、停机、关中断。
堆栈计算机，两个操作数隐藏在栈顶和次栈顶，计算结果压回栈顶。[ 后缀表达式 ]
一地址指令：单操作数或两个操作数。
OP(A1)->A1。将 A1 中的内容进行 OP 操作后，送入 A1 中。三次访存：取指，读 A1，写 A1。
(ACC)OP(A1)->ACC。将 ACC 和 A1 中的数据进行 OP 操作后，放入 ACC 中。
二地址指令：两个操作数的运算。
(A1)OP(A2)->A2。将 A1 和 A2 中的数据进行 OP 操作后，送入 A2 中。4 次访存：取指，读 A1，读 A2，写 A2。
三地址指令：三个操作数的运算。
(A1)OP(A2)->A3。
四地址指令：
(A1)OP(A2)->A3, A4=
A4= 这个操作是将 PC 的值修改为 A4 所指的地址。[ 一般情况下 PC+1 ]
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703491110359-ac31f8f1-1318-4777-a9ae-831110964337.png#averageHue=%23e0dddb&clientId=u6a946ed0-f203-4&from=paste&height=602&id=u50c31f44&originHeight=801&originWidth=1271&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=429656&status=done&style=none&taskId=ub6b3f400-6edd-427b-833d-eea36cc95bb&title=&width=956)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703491208802-9b33c9a9-c146-452d-9b2f-c60e3578ab87.png#averageHue=%23d4d9df&clientId=u6a946ed0-f203-4&from=paste&height=375&id=u8bc2bc67&originHeight=562&originWidth=1104&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=280256&status=done&style=none&taskId=ucdbcf23c-6e9f-402c-ae75-8bdfa2ec390&title=&width=736)
### 指令字长度
指令字长 = 机器字长 [ 字长 ] 单字长指令，此外还有半字长指令、双字长指令、一个半字长指令 etc。
定长指令字结构：指令系统中的指令字的长度是固定的。
变长指令字结构：指令系统中的指令字长度不固定。

### 分类
操作码的长度也不是一定的。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703515157887-400065ec-c26d-4352-95c4-e894114be97e.png#averageHue=%23f8f8f8&clientId=u5d8150cd-33b4-4&from=paste&height=532&id=ud6ae1c93&originHeight=798&originWidth=1930&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=378302&status=done&style=none&taskId=ua3a970c3-25ec-4e5f-b63c-2684c40f1a8&title=&width=1286.6666666666667)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703515305326-12f9fe1d-8f67-45b5-8436-1041c1d5b737.png#averageHue=%23f4f4f4&clientId=uf4c7175e-acdd-4&from=paste&height=789&id=u9941aa65&originHeight=1184&originWidth=2104&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=886112&status=done&style=none&taskId=u09251240-4521-46ee-b776-3ab3255b6b2&title=&width=1402.6666666666667)
### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703515322873-292b35f7-c045-4bfb-8547-ea2dfc9a3312.png#averageHue=%23f2f2f2&clientId=uf4c7175e-acdd-4&from=paste&height=642&id=ud479d17c&originHeight=963&originWidth=1727&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=474156&status=done&style=none&taskId=u7c569dfa-6832-4651-acdd-8c005710111&title=&width=1151.3333333333333)
## 4.1.2 扩展操作码指令格式
定长操作码格式+可变长操作码 -> 扩展操作码指令格式

### 例子
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703515665375-4fec2da1-2c03-4697-9fce-ac26c2f72018.png#averageHue=%23f4f4f4&clientId=ufc19ac3d-e9eb-4&from=paste&height=734&id=ub27fe263&originHeight=1101&originWidth=2241&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=553814&status=done&style=none&taskId=u5c33a254-e616-4b27-8199-f5290110ed8&title=&width=1494)
这里指令字长为固定的 16 位。
那么前面的四位当作 OP，后面 3 个 AD，那么 12bit 的 AD 地址可以随意写，前面的 4 位二进制数从 0000~1110 可以表示操作码，而 1111 表示这不是一个三地址操作码，而可能是 2 地址、1 地址、零地址指令。
从图中可以体会到 设置 1111 的意义。

设计操作码的注意点：
1.  不允许短码是长码的前缀。
举个例子，15 个三地址操作码，不能让他们为 2 地址操作码的前缀，0000 1100 会被识别为一个三地址操作码。只有 1111 这种扩展操作码的表示才可以作为前缀使用。
2. 各指令的操作码不能重复。
通常情况下，对于使用频率较高的指令分配较短的操作码。尽可能的减少指令译码和分析的时间。

设计操作码举例：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703658688373-d4b8f0d8-a07e-4012-835e-d96522733107.png#averageHue=%23dee3e4&clientId=ua63ae8d7-97df-4&from=paste&height=431&id=ua52317f6&originHeight=646&originWidth=2206&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=349824&status=done&style=none&taskId=uabde6a91-1b2f-4a9f-b945-1d89bc73921&title=&width=1470.6666666666667)
_15 条 3 地址指令_：0000-1110，没有什么好讲的。
_12 条 2 地址指令_：16 - 8 - 4 = 4 留有 4 位编操作码。那么就是 1111 0000~1011。
_62 条 1 地址指令_：在第二个 4bit 处留有 16 - 12 - 1 = 3 条指令，1111 用作扩展码用，16 - 4 -4 - 4 = 4，余下 4 位用作操作码。16 - 1 = 15，62 / 3 = 20 余 2，发现如果不用 1111 扩展码，会不足表示 62 条指令，所以应该把 1111 用于 1 地址指令。62 / 4 = 15 余 2。 那么就是 1100~1110—0000~1111 表示 3 * 16 = 48 位，余下来 62 - 48 = 14 位用 1111—0000~1101 表示。此时 9 ~12 位空余 2 个表示码。
_32 条 0 地址指令_：正好用 2 * 16 表示 32 条 0 地址指令。



## 4.2.1 指令寻址
## ![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703747082553-b1b580cb-af32-4834-a902-7e4929f370db.png#averageHue=%23f8f8f8&clientId=u1e40c13f-10bf-4&from=paste&height=619&id=ue3ad3b23&originHeight=929&originWidth=1540&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=273651&status=done&style=none&taskId=u560d7473-7b4c-4048-a921-da5e4383aac&title=&width=1026.6666666666667)
**PC 程序计数器指向下一条指令的地址。**

### 顺序寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703747956582-7308a4d9-5827-4ea8-b2e8-a3e26a5c56ac.png#averageHue=%23f0f0f0&clientId=u1e40c13f-10bf-4&from=paste&height=359&id=u34df91ea&originHeight=538&originWidth=1077&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=136952&status=done&style=none&taskId=ucbbcdb16-993f-4b31-8865-76d710962ce&title=&width=718)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703748185424-c5894c52-97c5-4c1c-bc92-0935b8a16701.png#averageHue=%23f0ece6&clientId=u1e40c13f-10bf-4&from=paste&height=649&id=u1cf87ef4&originHeight=973&originWidth=2249&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=553539&status=done&style=none&taskId=ua11f9421-b74b-471a-814d-dc819836b31&title=&width=1499.3333333333333)
以上都是顺序寻址的方式：（PC）+ [1] -> PC
这里的 1 是当前指令的字节数或字数。

### 跳跃寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703748382989-9e704f0b-2be6-4d85-8f2c-6135fb6bb619.png#averageHue=%23f5f5f5&clientId=u1e40c13f-10bf-4&from=paste&height=643&id=uf4bdb62a&originHeight=965&originWidth=2103&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=630337&status=done&style=none&taskId=u1efb6feb-0440-4956-8980-2a33ae27d75&title=&width=1402)

## 4.2.2 数据寻址
数据寻址就是确定指令中的地址的真实地址的方式。![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703748860991-0d2bd61c-dcfc-4ecf-857c-4614d7a0c3ab.png#averageHue=%23eae1df&clientId=u1e40c13f-10bf-4&from=paste&height=635&id=u634c4b1e&originHeight=952&originWidth=1725&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=455672&status=done&style=none&taskId=u2565735e-eb6d-49ac-9d8b-1af84f8280a&title=&width=1150)
其中的形式地址 D 也称作偏移量，是逻辑地址，不是真实的地址。
变址和间址组成**寻址方式特征位**。
操作数字段的地址码由形式地址和寻址方式特征位等组合而成。
如果没有变址和间址，形式地址 D 就是有效地址 E。![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703748993859-d0c74eb9-1061-45ba-8aee-1fdce01d9bd5.png#averageHue=%23bae7f6&clientId=u1e40c13f-10bf-4&from=paste&height=417&id=u451bdd7c&originHeight=626&originWidth=1569&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=143373&status=done&style=none&taskId=u755aa49b-b9b6-4671-86e6-516f00f68c1&title=&width=1046)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703749047528-ea649124-3e1e-4ddd-870e-be41abcd3499.png#averageHue=%23f6ebda&clientId=u1e40c13f-10bf-4&from=paste&height=1250&id=u6a812362&originHeight=800&originWidth=720&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=205817&status=done&style=none&taskId=ud4f37a39-df8c-4a45-a9a5-9536ea7fde0&title=&width=1125)


### 直接寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703749266623-001be0b2-e4bb-4ff3-9d45-39099f3feeb8.png#averageHue=%23f1f0eb&clientId=u1e40c13f-10bf-4&from=paste&height=851&id=u2dd366ef&originHeight=736&originWidth=1025&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=179736&status=done&style=none&taskId=ua19a48fe-0af2-49fd-b75a-15dcce5f4c7&title=&width=1185)
写入寄存器不算访存。是直接送入 ACC 中，所以总共访存 2 次。
形式地址 A 的位数有限，所以访存的地址范围很有限。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703828604472-f6ab50a6-e851-424f-be74-81afc709416a.png#averageHue=%23f8f5f3&clientId=u4f14d803-d6b6-4&from=paste&height=680&id=u4822ce13&originHeight=1020&originWidth=1568&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=210821&status=done&style=none&taskId=u0f7d84b7-dab8-4051-bc27-4f65103e528&title=&width=1045.3333333333333)

### 间接寻址
间接寻址就是通过 A 
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703749447454-00ec5c0c-a622-48d3-87e0-d994a994d8ec.png#averageHue=%23f1f1f1&clientId=u1e40c13f-10bf-4&from=paste&height=573&id=u0f12a931&originHeight=860&originWidth=2008&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=490470&status=done&style=none&taskId=uefce43b6-f76e-4be0-afe4-c91457b2954&title=&width=1338.6666666666667)
扩大了寻址范围这一点可以好好理解一下。
多级间接寻址的方式和函数调用可以互相对应。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703828595549-5633d0be-38fc-4572-b333-cc3f6c16a62c.png#averageHue=%23f1edeb&clientId=u4f14d803-d6b6-4&from=paste&height=659&id=u0c7ba8a7&originHeight=989&originWidth=1571&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=200479&status=done&style=none&taskId=uf4a98bd7-4c16-49dc-8650-a62ae4a2444&title=&width=1047.3333333333333)

### 寄存器寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703828583374-ee24c78f-18c6-407f-b4a5-d1f0d516e974.png#averageHue=%23e9e8e7&clientId=u4f14d803-d6b6-4&from=paste&height=633&id=ub8ed6d55&originHeight=950&originWidth=1581&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=505627&status=done&style=none&taskId=uc86f623d-5ccc-4c36-a7ba-64c21c4ee9b&title=&width=1054)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703828665627-671c1fd1-ed65-4600-9ef8-b325ee806616.png#averageHue=%23f2f2f2&clientId=u4f14d803-d6b6-4&from=paste&height=571&id=ud617ba4c&originHeight=856&originWidth=1898&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=374226&status=done&style=none&taskId=u50be9116-0bea-4156-8b53-f6c69ead53a&title=&width=1265.3333333333333)
操作数直接存储在寄存器中。
指令中的寻址位指明寄存器地址，不访问主存。
### 寄存器间接寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703848309362-88ea438c-cc55-4615-8129-7f7d5291a72b.png#averageHue=%23f4f4f4&clientId=u4f14d803-d6b6-4&from=paste&height=807&id=u0d215572&originHeight=1211&originWidth=1839&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=547661&status=done&style=none&taskId=u150bb822-4ae7-4e5a-b445-b5267252254&title=&width=1226)
### 隐含寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703848517531-18a096e0-4c1e-4d90-a2bf-058c50268000.png#averageHue=%23f3f3f3&clientId=u4f14d803-d6b6-4&from=paste&height=546&id=u7249e711&originHeight=819&originWidth=1615&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=249786&status=done&style=none&taskId=u893d124f-12b6-4550-84bd-2cc17857679&title=&width=1076.6666666666667)
比如一个二地址指令，A 中存放一个地址，另一个操作数地址隐含的存放在指令中，操作数放在 ACC 中，让 CPU 直接从 ACC 中取出操作数。
### 立即寻址![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703848638230-8be9e495-cdd3-490b-9b35-12fa4cf23e63.png#averageHue=%23ece8e7&clientId=u4f14d803-d6b6-4&from=paste&height=691&id=u8473941a&originHeight=1037&originWidth=1493&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=324778&status=done&style=none&taskId=uc3533d4a-acb2-4db0-b30b-110f7dea015&title=&width=995.3333333333334)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703848693045-9261072f-3975-4005-8735-2366387067a7.png#averageHue=%23f1f1f1&clientId=u4f14d803-d6b6-4&from=paste&height=430&id=udcee4cd4&originHeight=645&originWidth=2079&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=475894&status=done&style=none&taskId=ua9f816af-ef72-4103-903c-a3dcace9221&title=&width=1386) 

## 4.2.3 偏移寻址
## ![](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703748860991-0d2bd61c-dcfc-4ecf-857c-4614d7a0c3ab.png?x-oss-process=image%2Fresize%2Cw_1125%2Climit_0#averageHue=%23eae1df&from=url&id=x0udD&originHeight=621&originWidth=1125&originalType=binary&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&title=)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703858187369-e540a85c-7c80-44fa-855f-d58e3d04c6c3.png#averageHue=%23f4eaea&clientId=ud1bcd4cd-4f85-4&from=paste&height=485&id=uf0fe7b84&originHeight=727&originWidth=1585&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=315111&status=done&style=none&taskId=u044985b3-a255-48fe-be47-5becad06c6a&title=&width=1056.6666666666667)
### 基址寻址
CPU 中有基址寄存器 BR（base address register）。
将 BR 中的内容加上指令中的形式地址 A，形成操作数的有效地址。
EA = （BR）+ A
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703858316520-f53be434-4250-4325-ab21-e084a4eecdfd.png#averageHue=%23ededed&clientId=ud1bcd4cd-4f85-4&from=paste&height=378&id=uae402cdc&originHeight=567&originWidth=846&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=106893&status=done&style=none&taskId=u9a93854e-ce7c-4811-ac3a-cd6f4f3e5c3&title=&width=564)
操作系统中的重定位寄存器就是基址寄存器。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703858407792-c6aee7fe-0a88-4713-9f24-45e4ffccdef2.png#averageHue=%23f0f0f0&clientId=ud1bcd4cd-4f85-4&from=paste&height=388&id=u941f5622&originHeight=582&originWidth=984&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=138662&status=done&style=none&taskId=u279e346b-b785-4cb5-90c1-c12cdd73847&title=&width=656)
指令中会告知采用哪种寄存器作为基址寄存器。
这里的 R0 为表示通用寄存器中存储基址的寄存器的地址的位数。
问题：R0 应该占据多少 bit？应该根据通用寄存器的个数。如果通用寄存器的个数为 8 个，那么只需要 3 位即可。
基址寻址的作用：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703858815426-d9d2bb6f-988c-4a62-bd13-640e6c44eee3.png#averageHue=%23b3c561&clientId=ud1bcd4cd-4f85-4&from=paste&height=851&id=ubb699cbe&originHeight=1277&originWidth=2227&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1437700&status=done&style=none&taskId=u09adad94-464f-4fd4-ac20-69580344b8e&title=&width=1484.6666666666667)
基址寄存器是面向操作系统的，其内容由操作系统或管理程序确定。
在程序执行过程中，基址寄存器的内容不变。形式地址可变。
基地址不变，偏移量可变。
当采用通用寄存器作为基址寄存器的时候，可以由用户决定哪个寄存器作为基址寄存器，但是 BR 的内容，也就是 base address 仍然由 OS 决定。

基址寻址的优点：
可以扩大寻址范围（基址寄存器的位数大于形式地址 A 的位数），用户不必考虑自己的程序存于主存的哪一空间区域。故有利于多道程序设计。以及可用于编制浮动程序。

### 变址寻址
BR 是将 BR 作为基地址，A 作为偏移量，EA = (BR) + A
IX（index register）是将 A 作为基地址，IX 中存放偏移量，EA = (IX) + A
IX 中的内容可以由用户写入。

比如以下程序：
for (int i = 0; i < 10; i++)
	sum += a[i];
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703860255453-329bc813-761c-4352-8153-a47ba1062f2e.png#averageHue=%237a7f7f&clientId=ud1bcd4cd-4f85-4&from=paste&height=671&id=u13fc9983&originHeight=1007&originWidth=1438&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=705331&status=done&style=none&taskId=ucdb69337-de2e-4a55-95cd-3a570f51db0&title=&width=958.6666666666666)
可以看到每一次的加法都需要用到一条指令去进行 ACC 累加。
如果循环的次数很大，按照这种方式会需要很多的 [ 类似 ] 指令，比较浪费空间。

现在用变址寻址来改进：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703860385690-f44617b0-f303-4635-b50b-21ff3d36b0aa.png#averageHue=%23b3b7b6&clientId=ud1bcd4cd-4f85-4&from=paste&height=723&id=uf360a620&originHeight=1085&originWidth=1568&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=700782&status=done&style=none&taskId=u55e9e37b-268e-4978-bd8c-ae659c7f9fa&title=&width=1045.3333333333333)
这也就解决了空间浪费的问题。

总结：
![](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703861139671-7782864e-df93-48ef-8016-9a08e911cfe5.png?x-oss-process=image%2Fresize%2Cw_1125%2Climit_0#averageHue=%23f4f3e4&from=url&id=BkAIn&originHeight=658&originWidth=1125&originalType=binary&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&title=)
### 一道题目
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703862749636-5ca7161b-a338-4184-a598-f7e2a4b6a04c.png#averageHue=%23e5e5e5&clientId=ue5bdd187-e7bd-4&from=paste&height=806&id=u1a1c63e4&originHeight=1209&originWidth=1696&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=868498&status=done&style=none&taskId=udf49b413-b7ef-4061-adb9-c45fb835bd9&title=&width=1130.6666666666667)
### 基址寻址 & 变址寻址复合寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703861286279-fd0b81ff-e550-4fa6-acc7-13dc8650b320.png#averageHue=%23afc490&clientId=ud1bcd4cd-4f85-4&from=paste&height=889&id=u91baa134&originHeight=1333&originWidth=2257&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1141255&status=done&style=none&taskId=uaf6af524-54a9-43ee-8d87-f795fc06cf8&title=&width=1504.6666666666667)

### 相对寻址
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703862095729-45f72d2d-eba9-4c56-b1cf-8002e08f9862.png#averageHue=%23f7f6f6&clientId=ue5bdd187-e7bd-4&from=paste&height=763&id=u043ca2cc&originHeight=1144&originWidth=1895&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=376710&status=done&style=none&taskId=u3ccdaffb-5d40-42d0-9a7e-d3e1837f220&title=&width=1263.3333333333333)
相对寻址是最简的，单纯的让 PC 加上 A 偏移量得到新的指令地址。
相对寻址的作用可以用 Jmp 指令来展示：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703862319740-ac0dd9f8-87aa-41c7-abfd-ef57a14eeac4.png#averageHue=%238a9686&clientId=ue5bdd187-e7bd-4&from=paste&height=734&id=u4db81554&originHeight=1101&originWidth=1597&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=708334&status=done&style=none&taskId=u557078e1-cfdc-4daf-bd65-ce3f0f9f3fe&title=&width=1064.6666666666667)
可以看到，目前这张图中主存地址是由 0 开始计数的，如果是从 100 呢？这是 Jmp 指令用间接寻址的方式便很容易去跳转到 [ 2 ] 号指令了。

相对寻址的优点：
操作数的地址不是固定的，它随着 PC 的值在不断的变化，并且与指令地址之间总是相差一个固定值。因此便于程序浮动。相对寻址广泛运用于转移指令。
## 


## 4.2.4 堆栈寻址
操作数存放在堆栈中，隐含使用堆栈指针 SP 作为操作数地址。
SP: Stack Pointer




## 4.4 CISC & RISC
CISC 和 RISC 是两种设计方向。
CISC Complex Instruction Set Computer
RISC Reduced Instruction Set Computer
复杂指令集和简易指令集计算机系统。
CISC：x86
RISC：ARM
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703867132139-19feb0e6-dde4-40ff-a6ee-dc190f627109.png#averageHue=%23f3f2f2&clientId=ue5bdd187-e7bd-4&from=paste&height=847&id=u68f32d17&originHeight=1270&originWidth=2138&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=866469&status=done&style=none&taskId=u8b49825f-b000-405d-b76d-a105b80680d&title=&width=1425.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703867157305-3591c165-318b-480f-99f9-e546a9f25254.png#averageHue=%23e6e6e6&clientId=ue5bdd187-e7bd-4&from=paste&height=333&id=u0950b21c&originHeight=499&originWidth=1115&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=135473&status=done&style=none&taskId=u16eea743-d05d-4145-9017-761717ca2b4&title=&width=743.3333333333334)


# 第五章 CPU
## 引—计算机工作的过程
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703867523903-4cda2195-471b-4a36-aca7-df1092342e00.png#averageHue=%23e3e1df&clientId=ue5bdd187-e7bd-4&from=paste&height=878&id=u3dae29f4&originHeight=1317&originWidth=2322&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1392239&status=done&style=none&taskId=u42a49db9-f0f8-48ac-971b-18ebadf3023&title=&width=1548)
CPU 执行程序的过程就是执行一条条指令的过程，程序计数器 PC 指向下一条应该执行的指令。

1. CPU 将 PC 中的指令存放地址放入 MAR 地址寄存器中。
2. 然后根据指令地址取出指令。
3. 这条指令会首先放入 MDR 中。(Memory Data Register)
4. 指令由 MDR 传入到 IR 中。（经过 1234 步骤，就完成了取指令的步骤，而完成了取指令的操作后，PC 计数器会自动+1）
5. IR 中取到的指令，操作码部分送入 CU 中。（CU 根据操作数判断下一步进行什么操作）
6. 在 CU 的协调下，CU 将 IR 中的指令的地址码送入 MAR 中。
7. 根据 MAR 的地址，去主存中找到数据。
8. 将数据存入 MDR 中。
9. MDR 的数据送入 ACC 中。

以上是第一条指令的执行过程。是一条取数指令。

CU 如何确定每一步应该做什么事情，就是 CPU 的重点。
大致分为以下五个部分：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703868963085-5bd53dec-7901-45d8-958f-a76dc25bf2e1.png#averageHue=%23fbfbfb&clientId=ue5bdd187-e7bd-4&from=paste&height=825&id=ud939fffc&originHeight=1237&originWidth=1581&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=539718&status=done&style=none&taskId=u37dedc59-c6bb-4171-be04-f7585c30091&title=&width=1054)
### 重点
#### CPU 的基本功能、CPU 的组成、运算器、控制器、cache、数据通路结构、CPU 内各寄存器的功能
#### 指令执行过程
#### 何谓指令周期
#### 双总线结构数据通路、指令周期流程图及相对应的微操作控制信号序列【重点】
#### CPU 数据通路结构（单总线）、用寄存器级传送语言拟定指令流程、列出相应的微命令序列
#### 同步控制与异步控制的含义、特点及应用场合
#### 主设备、从设备
#### 环形脉冲发生器的原理及逻辑结构
#### 微程序控制的基本思想【重点】、微程序、微命令、微指令、微操作的概念
#### 相容性微操作、相斥性微操作
#### 微程序控制器的组成原理及时序划分【重点】
#### 后续微地址 

## 5.1.1 CPU 的功能和基本结构
引：计算机解决问题需要人为的编写程序，而程序就是一个指令序列。这个序列明确的告诉我们计算机应该执行什么操作，在什么地方找到数据。CPU 就是用来自动完成取指令和执行指令的元件。
### CPU 功能
CPU 的功能有以下四个方面：

1. 指令控制
完成取指令，分析指令，执行指令的操作。
2. 操作控制
一条指令的执行需要多个细分的操作，CPU 需要提供多个操作信号，每一种操作信号对应着一种微操作，通过多种信号的组合，可以执行一个完整的指令。把各个操作信号送入相应的器件，控制这些元件执行指令要求的动作。
3. 时间控制
各种操作信号均受到时间的严格定时（操作的同步性，时序关系，减少冒险 etc），不光操作信号受到时间限制，一条指令也是有严格的时间定时的，所以，CPU 需要对各种操作信号实施时间上的定时，这就是时间控制。
4. 数据加工
对数据进行算术运算和逻辑运算处理。
5. 中断处理

对计算机运行过程中出现的异常情况和特殊请求进行处理。

### CPU 基本结构
运算器（ALU）、控制器、存储器。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703869714145-eb33ec97-687d-4239-8c68-eb1641ac5666.png#averageHue=%23fefefe&clientId=ue5bdd187-e7bd-4&from=paste&height=621&id=u7f214fcb&originHeight=932&originWidth=1167&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=183296&status=done&style=none&taskId=u09887b03-c279-474b-ab7d-7e25cd6bf77&title=&width=778)
控制器和运算器是核心。
运算器负责对数据进行加工。

1. 执行所有的算术运算。
2. 执行所有的逻辑运算，并进行逻辑测试，包括 0 值测试或两个值的比较。

一条算术运算产生一个结果，一条逻辑运算产生一个判决。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703870025961-a28402de-a5a3-470b-b9b7-3f75b9d4fa3f.png#averageHue=%23e9e9e9&clientId=ue5bdd187-e7bd-4&from=paste&height=729&id=u592bcc6f&originHeight=1094&originWidth=1470&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=326424&status=done&style=none&taskId=u21b462ba-e5cd-433a-b697-ce239844055&title=&width=980)
控制器负责协调并控制各个部件执行指令，基本功能包括取指令、分析指令、执行指令。

1. 取指令：自动形成指令地址、自动发出取指令命令。
2. 分析指令：操作码译码（分析这条指令想要完成的操作）、产生操作数的有效地址（指令寻址）。
3. 执行指令：根据分析指令得到的 [ 操作 ] 和 [ 操作地址 ]，形成操作信号控制序列，控制运算器、存储器以及 IO 设备完成相应的操作。
4. 中断处理：管理总线及输入输出、处理异常情况和特殊请求。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703870015141-56e1cf54-6013-4475-999b-68e8cc18616b.png#averageHue=%23e9e8e8&clientId=ue5bdd187-e7bd-4&from=paste&height=631&id=u18c01f04&originHeight=947&originWidth=1683&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=343295&status=done&style=none&taskId=u548d08c4-5fc4-4cd5-afb4-964ec33a20e&title=&width=1122)
#### 运算器组成
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874162247-463f1167-b492-495f-a260-ac24aeabd68d.png#averageHue=%23e5e4e4&clientId=ue5bdd187-e7bd-4&from=paste&height=704&id=QEI90&originHeight=1056&originWidth=2230&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1121273&status=done&style=none&taskId=u811e749f-5080-4cd7-a4d0-f6a648709ac&title=&width=1486.6666666666667)

ALU、通用寄存器、DR、PSWR。
运算器是由控制器进行控制的，是执行部件。

1. 算术逻辑单元 ALU。
2. 通用寄存器组。

x86 架构的寄存器组是这样表示的，AX、BX、CX、DX、SP 等。
用于存放操作数。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703873088222-9f797990-8e4e-408f-be14-b9bfe2d28397.png#averageHue=%23f2f2f2&clientId=ue5bdd187-e7bd-4&from=paste&height=528&id=uaf6c04f7&originHeight=792&originWidth=1051&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=70120&status=done&style=none&taskId=u4a3046e9-cac6-40a8-8418-02affcd87b1&title=&width=700.6666666666666)
下面看数据联通：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703873144333-e757b3c6-2116-48a9-99d7-a5119ad2fcaa.png#averageHue=%23f0f0ef&clientId=ue5bdd187-e7bd-4&from=paste&height=474&id=u64a4198e&originHeight=711&originWidth=576&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=55662&status=done&style=none&taskId=uf1b16eaf-0119-4ed8-b999-40ed3f0a6ab&title=&width=384)
专用数据通路方式：根据指令执行过程中的数据和地址的流动方向安排连接线路。
优点：性能较高，基本不存在数据冲突现象。但是结构复杂，硬件量大，不易实现。


ALU 的输入端和寄存器连接，如何决定哪一路输入到 ALU 中？
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703873713930-4e28ff87-0d57-4f43-9404-1c8adc2c3570.png#averageHue=%23f9f8f7&clientId=ue5bdd187-e7bd-4&from=paste&height=472&id=u0bca1616&originHeight=708&originWidth=1376&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=563405&status=done&style=none&taskId=u27ac83bd-f8d9-4509-a114-62f60da7b88&title=&width=917.3333333333334)


CPU 单总线模式：
将所有寄存器的输入端连接在同一个输入端和输出端都连接到一条公共的线路中。
可以从总线中输入信号，也可以输出信号。
这种方式结构简单，容易实现，但是数据传输存在较多的冲突现象。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703873922551-758941ac-97e3-4c7f-97eb-6a58895c0c0a.png#averageHue=%23efefee&clientId=ue5bdd187-e7bd-4&from=paste&height=683&id=ud2c5fa1b&originHeight=1024&originWidth=2212&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=577463&status=done&style=none&taskId=u801fa36f-54ed-401d-97b4-98095c0eebf&title=&width=1474.6666666666667)
冲突：
ADD R0 R1
R0 和 R1 的数据要写入 ALU 中，但是这种单总线方式会导致数据冲突。
这种问题可以通过增加一个暂存寄存器的方式解决。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874049281-cfc1082d-ad4c-4e8a-9831-5c0a09f4a294.png#averageHue=%23eeeeee&clientId=ue5bdd187-e7bd-4&from=paste&height=460&id=u45b31dbc&originHeight=1084&originWidth=1074&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=240716&status=done&style=none&taskId=u0cf6ddce-bb97-4b42-a3e6-a1b55cb6f98&title=&width=456)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874097899-7a1a786c-4b6e-44cd-9636-5384df54838b.png#averageHue=%23e4d6d6&clientId=ue5bdd187-e7bd-4&from=paste&height=134&id=ufd84688f&originHeight=288&originWidth=1096&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=331841&status=done&style=none&taskId=uf836c555-17f5-45f3-b03e-3d97f54fb59&title=&width=508.66668701171875)

总结：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874162247-463f1167-b492-495f-a260-ac24aeabd68d.png#averageHue=%23e5e4e4&clientId=ue5bdd187-e7bd-4&from=paste&height=704&id=ue2acc7e8&originHeight=1056&originWidth=2230&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1121273&status=done&style=none&taskId=u811e749f-5080-4cd7-a4d0-f6a648709ac&title=&width=1486.6666666666667)

#### 控制器组成
程序计数器 PC、指令寄存器 IR、指令译码器 ID（Instruction Decoder）、操作控制器 CU、时序产生器。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874387636-8f2b98f8-1e45-4d2b-8d16-f4b68b54a246.png#averageHue=%23e9e8e6&clientId=ue5bdd187-e7bd-4&from=paste&height=831&id=u549c24d9&originHeight=1247&originWidth=2262&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1120220&status=done&style=none&taskId=u8ed33d0a-40f8-48c4-bb63-200628ebfb5&title=&width=1508)
#### CPU 基本结构
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703874479851-71d04cbf-1c8c-41d0-85b2-235861aa359f.png#averageHue=%23eeebe7&clientId=ue5bdd187-e7bd-4&from=paste&height=816&id=u5fe48dc1&originHeight=1224&originWidth=2249&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=760541&status=done&style=none&taskId=u27a9794f-ef61-48c1-ad7a-0b4d397b4b4&title=&width=1499.3333333333333)
ALU、CU、寄存器、中断系统。
#### 总结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703875114055-15767616-e4e0-460d-98ca-776ab07f55ce.png#averageHue=%23fcefef&clientId=ue5bdd187-e7bd-4&from=paste&height=742&id=u0c7980c4&originHeight=1113&originWidth=2191&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=816897&status=done&style=none&taskId=u8c7f6ddd-8da3-491c-bda1-28975981206&title=&width=1460.6666666666667)
## 5.2 指令周期的数据流
补充一些知识：
数据通路：许多寄存器之间交换传送信息的通路。
操作控制器 CU：在多个寄存器间建立数据通路。（功能就是根据指令码操作码和时序信号，产生各种操作控制信号，以便正确地选择数据通路）

操作控制器 CU 根据设计方法的不同，分为时序逻辑型和存储逻辑型。
硬布线控制器和微程序控制器。
### 指令周期
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703925812930-03760818-196d-4b2e-88f8-fbbe06ab18bd.png#averageHue=%23f4f4f4&clientId=u75f52eb8-4054-4&from=paste&height=561&id=u6533bab4&originHeight=842&originWidth=842&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=160667&status=done&style=none&taskId=u08a221c9-8bbe-48bd-838f-9f4d61ec17a&title=&width=561.3333333333334)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703926141475-d14de75c-6fdb-4570-a00b-3390b0053c04.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=264&id=u3b1f7e9c&originHeight=396&originWidth=1018&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=34662&status=done&style=none&taskId=ufa436caf-769a-4511-af80-a669cc62879&title=&width=678.6666666666666)
指令周期：CPU 从主存中取出并执行一条指令的时间。
指令周期常用若干机器周期来表示，机器周期又叫做 CPU 周期。
CPU 访问内存花费的时间较长，因此用内存中读取一个指令字的最短时间来规定 CPU 周期。
而一个 CPU 周期中又包含若干时钟周期。（又称 T 周期或节拍脉冲，是处理操作的最基本单位）
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703926414031-4be1c67d-0482-433e-9507-c2ba14522a19.png#averageHue=%23e7e6e6&clientId=u75f52eb8-4054-4&from=paste&height=288&id=uf45050f9&originHeight=943&originWidth=1587&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=335499&status=done&style=none&taskId=u62a056b5-5f91-4dff-9036-61648f107bb&title=&width=485)

单周期 CPU 和多周期 CPU。

1. 单周期 CPU：在一个时钟周期内完成从取指令到得到结果的所有工作，指令系统中所有指令执行时间都以最长的指令字为准，因此效率低。
2. 多周期 CPU：把指令划分为多个阶段，每个阶段都在一个时钟周期内完成，因而一个时钟周期较短，不同指令所用的周期数不同。
### 指令周期的一些例子
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703926682907-6801611f-6757-4dab-8697-cba4072936d2.png#averageHue=%23f2f2f2&clientId=u75f52eb8-4054-4&from=paste&height=409&id=u73339be6&originHeight=613&originWidth=1148&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=138551&status=done&style=none&taskId=u11b4e644-273d-4de2-9936-553985fab88&title=&width=765.3333333333334)
可以看到指令周期需要的机器周期不一定相同，每个机器周期所需要的 T 周期也不一定相同。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703926711920-34499b8e-de36-487f-afe9-42f3b7a20eea.png#averageHue=%23e9e9e9&clientId=u75f52eb8-4054-4&from=paste&height=349&id=uddfa22fe&originHeight=523&originWidth=1091&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=109139&status=done&style=none&taskId=u36e8bacf-6085-4478-a323-6123cb95423&title=&width=727.3333333333334)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703926888845-614bb2d0-6dec-44a2-88d5-49d4bc430ad4.png#averageHue=%23ededec&clientId=u75f52eb8-4054-4&from=paste&height=544&id=u529e4ee3&originHeight=1103&originWidth=950&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=256813&status=done&style=none&taskId=ub74d479e-81cd-4e8f-9258-6334f7250d3&title=&width=468.3333740234375)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703927128750-9b03544a-73d6-4515-980c-287aef3ca167.png#averageHue=%23ebe9e9&clientId=u75f52eb8-4054-4&from=paste&height=341&id=u3b1b67ec&originHeight=512&originWidth=660&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=90847&status=done&style=none&taskId=u10f148c8-a44f-4e29-acc7-46e6cc83e33&title=&width=440)
### 数据流向展示

1. 取指周期
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703927358441-d2ca0c77-53f7-49c4-91ec-8a8ebbb1e7c6.png#averageHue=%23ebe7e5&clientId=u75f52eb8-4054-4&from=paste&height=283&id=u4a11e472&originHeight=822&originWidth=1414&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=220010&status=done&style=none&taskId=ua3174c07-2a5a-4e57-838e-8df83308bb9&title=&width=487)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703927553574-eb230265-954f-41b9-a895-a55cd251c1b0.png#averageHue=%23d7d7d7&clientId=u75f52eb8-4054-4&from=paste&height=369&id=ud4b18671&originHeight=643&originWidth=836&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=279128&status=done&style=none&taskId=u8b414d13-71ea-4d8e-b8e5-cbb8f421708&title=&width=480.3333435058594)

2. 间指周期

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703927799024-da132238-5b43-4f01-8228-da1c51e19c13.png#averageHue=%23ece8e5&clientId=u75f52eb8-4054-4&from=paste&height=274&id=uac0f83ae&originHeight=811&originWidth=1388&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159593&status=done&style=none&taskId=u2015dcb6-3847-4886-be7d-2ad3fc449f1&title=&width=469)
有些地址可能不是 EA，需要寻址。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703928159809-9f75f525-5e00-46eb-96f6-138378070c58.png#averageHue=%23dbdbdb&clientId=u75f52eb8-4054-4&from=paste&height=306&id=uc61857d2&originHeight=536&originWidth=837&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=221464&status=done&style=none&taskId=u5376a97c-e849-4b80-8615-cefc1d74969&title=&width=478)

3. 执行周期

这一阶段，不同指令操作不同，因此没有统一的数据流向。

4. 中断周期

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703928345622-0c9eb377-5d0b-44bf-8e18-89207c648b32.png#averageHue=%23eae7e5&clientId=u75f52eb8-4054-4&from=paste&height=292&id=u4dce8d8c&originHeight=438&originWidth=698&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=38183&status=done&style=none&taskId=uaffda25b-6cbe-4085-b049-a31c8b2bc50&title=&width=465.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703928350884-632f7be4-16c9-4b1c-b061-423a3577025b.png#averageHue=%23e1e1e1&clientId=u75f52eb8-4054-4&from=paste&height=512&id=uf5ae11be&originHeight=498&originWidth=423&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=122593&status=done&style=none&taskId=uf54aefae-d6f8-4372-b538-fb3a2005f7e&title=&width=435)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703928452846-089ab141-57c7-4d33-beab-8e059c9ccfb8.png#averageHue=%23ebebeb&clientId=u75f52eb8-4054-4&from=paste&height=385&id=u312258fb&originHeight=577&originWidth=1124&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=251801&status=done&style=none&taskId=ud4596280-906b-4617-a309-91787ffdc69&title=&width=749.3333333333334)
### 总结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703928559576-5e43952b-52db-4a62-b5c2-868a7e195931.png#averageHue=%23fefcfc&clientId=u75f52eb8-4054-4&from=paste&height=744&id=u8af0eb7a&originHeight=1116&originWidth=1958&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=699260&status=done&style=none&taskId=ua545f701-5c43-42a8-90cc-9e05dafcf8c&title=&width=1305.3333333333333)
### 一些实例：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703929452857-d9db6f05-7bde-40b8-aa2a-cddb4d276601.png#averageHue=%2335c968&clientId=u75f52eb8-4054-4&from=paste&height=725&id=uae19b749&originHeight=1088&originWidth=1470&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=292100&status=done&style=none&taskId=udcd2d441-3543-4df6-8956-3dbfc224950&title=&width=980)

1. CLA 指令周期

CLA 是清除 AC 内容的指令，需要两个 CPU 周期，取指令，执行指令。
取指令：
PC -> MAR
(PC) + 1 -> PC
MAR -> ABUS
主存中所选地址的数据 -> DBUS -> MDR
DR -> IR (DR) = (IR) = CLA = 250 000
IR 对操作码进行译码或测试
CPU 识别到 CAL 指令
执行指令阶段：
CU 将操作信号送入 ALU 中
ALU 中 AC 内容清零：(AC) = 0

2. ADD 指令周期


### 用方框图表示指令周期
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703948446250-80f706e3-1f92-4b62-bf80-c0afab013cb7.png#averageHue=%23e3e1e0&clientId=u75f52eb8-4054-4&from=paste&height=734&id=u901a1f51&originHeight=1101&originWidth=1562&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=584768&status=done&style=none&taskId=ucfcfb37b-72bc-4f65-80a8-26b6e4034ed&title=&width=1041.3333333333333)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703948453107-114199ba-c9b9-4c30-994c-d57c8b5f9d9a.png#averageHue=%23f8f8f8&clientId=u75f52eb8-4054-4&from=paste&height=713&id=ube19fbb4&originHeight=1070&originWidth=1604&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=30984&status=done&style=none&taskId=u0988fa18-2fa3-4f06-b7c4-5c67b503b95&title=&width=1069.3333333333333)



## 5.3.1 数据通路—单总线结构
内部总线：是部件内部的连接通路。比如 CPU 内部连接各寄存器及运算部件之间的总线。
系统总线：是指同一台计算机系统的各部件相互连接的总线。

数据传送一共有三种种类：

1. 寄存器与寄存器之间
2. 寄存器与 ALU 之间
3. 寄存器与主存之间


![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703941628267-22c78662-808a-4f3a-b64f-10290696f84c.png#averageHue=%23e8e7e3&clientId=u75f52eb8-4054-4&from=paste&height=391&id=u9b2d0afa&originHeight=586&originWidth=1084&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=286784&status=done&style=none&taskId=ue868015b-b238-4e91-8848-fd5df66d1f6&title=&width=722.6666666666666)
### 例题
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703942092632-19749697-8ea0-4781-8b0a-8677b60a5f0a.png#averageHue=%23f4f4f4&clientId=u75f52eb8-4054-4&from=paste&height=470&id=u209827f5&originHeight=1111&originWidth=1205&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=239125&status=done&style=none&taskId=u8e8f5b92-37c9-46be-b9be-242d4bf7b8b&title=&width=510)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703942103570-6361d1c9-f68e-4241-a7a7-a62c0653375a.png#averageHue=%23e0e0e0&clientId=u75f52eb8-4054-4&from=paste&height=405&id=u68241c03&originHeight=922&originWidth=1063&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=372831&status=done&style=none&taskId=u63b004bf-36ce-42a6-be43-0ab85f9ed60&title=&width=466.66668701171875)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703942145564-7a178873-d30b-4364-971a-8124eb6b14c5.png#averageHue=%23e0e0e0&clientId=u75f52eb8-4054-4&from=paste&height=233&id=u1900d52c&originHeight=530&originWidth=1050&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=201247&status=done&style=none&taskId=u213b53a3-022c-4f92-81f4-dca4bb42157&title=&width=462)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703942160786-be1ca408-c948-48d7-a025-f4acf46719a4.png#averageHue=%23e1e1e1&clientId=u75f52eb8-4054-4&from=paste&height=257&id=u2dbc270a&originHeight=599&originWidth=1067&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=246053&status=done&style=none&taskId=u3be97e8f-059c-484a-8642-d50acb2fd4f&title=&width=458.3333740234375)

### 双总线数据通路
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703942214774-3a478242-97eb-49f5-8489-10c41fa39f25.png#averageHue=%23efefef&clientId=u75f52eb8-4054-4&from=paste&height=727&id=ufe8bd7f7&originHeight=1091&originWidth=1721&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=439927&status=done&style=none&taskId=u246e16af-bcb2-4af3-b098-4f81cbd7a11&title=&width=1147.3333333333333)
## 5.3.2 数据通路—专用通路结构
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703948768428-52121920-9d8d-4ac1-9985-0876294d82f7.png#averageHue=%23ebebeb&clientId=u75f52eb8-4054-4&from=paste&height=463&id=u00dec8e3&originHeight=694&originWidth=1518&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=246476&status=done&style=none&taskId=ufd78ee99-efc2-4db8-8b30-7f91b2a3760&title=&width=1012)
### 例题
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703948799403-347db6c7-e950-47aa-82b8-9f12e21274f4.png#averageHue=%23e1e0e0&clientId=u75f52eb8-4054-4&from=paste&height=517&id=ub6414e81&originHeight=776&originWidth=1308&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=411032&status=done&style=none&taskId=uaa738e52-a82c-4146-9623-86c715ae71a&title=&width=872)

1. a：MDR，b：IR，c：MAR，d：PC 
2. 取指令的数据通路：
(PC) -> MAR
M(MAR) -> MDR
(MDR) -> IR
(OP)IR -> 微操作信号发生器
(PC) + 1 -> PC
3. 简述数据在运算器和主存之间进行存取的数据通路：
M(MAR) -> MDR
(MDR) -> ALU -> ACC
(ACC) -> MDR
(MDR) -> M(MAR)
4. 简述完成指令 LDA X 的数据通路（）：

## 【插入】时序产生器和控制方式


## 5.4.1 硬布线控制器的设计【future promise】
这部分内容在 PPT 中完全没有展示，只是在几处提到这个概念，大致看了一下，是用组合逻辑电路的方式设计控制器的，期末不会考到。
## 5.4.2 微程序控制器的基本原理
### 回顾
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703950321143-63b0f81d-e90b-43f4-94b1-9336d820ee9c.png#averageHue=%23e0d1ae&clientId=u75f52eb8-4054-4&from=paste&height=397&id=u0bdb6060&originHeight=595&originWidth=1044&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=521248&status=done&style=none&taskId=u57683a72-8979-49d3-9533-99452b9d86b&title=&width=696)

一台计算机可以分为控制部件和执行部件，控制器就是控制部件，而运算器等就相当于执行部件。
两者通过控制总线进行联系。
控制部件通过控制线向执行部件发出控制命令，让执行部件去执行一系列操作，这种控制命令称为微命令。
执行部件执行的操作，称为微操作。
两个微操作，如果可以在一个 CPU 周期内执行，称为相容性的微操作，反之，称为相斥性的微操作。
在一个 CPU 周期中，一组实现一定操作功能的微命令的组合，称为微指令。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703951739098-23eb37a4-ae4a-4554-9438-01010a0a5a61.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=192&id=u773ccecb&originHeight=357&originWidth=1055&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=58189&status=done&style=none&taskId=ua4d4dd31-f003-4dfa-9ba0-784372391a3&title=&width=566.3333740234375)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703951901357-a58d0596-e49f-4c07-aaef-098b754842bb.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=472&id=ua81b6c6e&originHeight=708&originWidth=666&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=34451&status=done&style=none&taskId=u8199818d-0451-444d-af17-d6dea19cffa&title=&width=444)
可以看到，微指令的构成。
这里例子中微指令的字长为 23 位，其中前 17 位每一位代表一个微命令，比如第一位的 LDR1’，发出LDR1’微命令，运算器将执行 ALU -> R1'的微操作。
顺序控制部分又称微地址码字段，用来决定产生下一条微地址指令的地址。
完成指定任务的微指令序列称为微程序。一条机器指令器功能可由一段微程序解释完成。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703952381597-617373d8-c27d-4b3d-9f02-e5c3819582d7.png#averageHue=%23f2ece9&clientId=u75f52eb8-4054-4&from=paste&height=350&id=u8ff62b70&originHeight=603&originWidth=850&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=249974&status=done&style=none&taskId=uf99151dc-2a76-4df4-acd6-38536199194&title=&width=492.66668701171875)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703954182011-d5652889-e55d-48b0-bdd2-f0fe5e1687ec.png#averageHue=%23eae8dd&clientId=u75f52eb8-4054-4&from=paste&height=588&id=u9bd8c5b8&originHeight=882&originWidth=1590&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1002161&status=done&style=none&taskId=u076bfedb-13c7-4e9e-9d8e-7f53f42b7ef&title=&width=1060)
可以看这个图再理解一下微操作，微命令，微指令，微程序。

### 微程序控制器的基本结构【重点】
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703954272087-3395dd7f-e9c3-4758-8df0-5f17ff6d59e9.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=339&id=ua101f9a1&originHeight=483&originWidth=911&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=59716&status=done&style=none&taskId=u20e01a46-31cf-4365-89b3-17b5dc43918&title=&width=640.3333740234375)

1. 控制存储器 CM
CM 中存储着全部的微程序，实现全部微指令的微程序。
只读型存储器 ROM(读取速度非常快、比 RAM 快，非易失性)。
工作流程：取出一条微指令，执行这条微指令，取出下一条微指令，执行这条微指令...
微指令周期：取出一条微指令并执行这条微指令的周期。
2. 微地址寄存器 CMAR / μPC / μAR
3. 微指令寄存器 CMDR / μIR
用于存放从 CM 中读出的微指令，位数和微指令字长相等。
存放现行微指令。
其中微命令字段存放提供一步操作所需要的微命令。
微地址字段指明后续微地址的形成方式、~~提供微地址的给定部分~~。
4. 微地址形成部件
产生初始微地址和后继微地址，以保证微指令的连续执行。
提供以上两类地址。
微程序入口地址：由机器指令操作码形成。
~~后续微地址：由微地址字段、现行微地址、运行状态等形成。~~
5. 地址译码
将地址码转换为存储单元控制信号。


![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703954945469-b4ad68ea-d131-4a20-81d5-428844c74fb3.png#averageHue=%23eceae8&clientId=u75f52eb8-4054-4&from=paste&height=550&id=u2d3c1188&originHeight=825&originWidth=1566&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=751012&status=done&style=none&taskId=ufd808410-4b3c-4c2a-9c40-c60a8cf44ac&title=&width=1044)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703955050517-e26ca7a3-ba43-4b36-a5a0-833294ec7a24.png#averageHue=%23e2e0e0&clientId=u75f52eb8-4054-4&from=paste&height=269&id=u348420fc&originHeight=404&originWidth=861&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=76876&status=done&style=none&taskId=u75802194-ccb6-4e62-ac8e-097859fd03c&title=&width=574)
### 微程序控制器的工作原理
### ![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703955929672-394dd18d-a13c-49c6-8e84-0482b3374ade.png#averageHue=%23ecebe9&clientId=u75f52eb8-4054-4&from=paste&height=599&id=u1fee4435&originHeight=898&originWidth=1607&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=573451&status=done&style=none&taskId=u8edd428c-c708-47f2-a1bc-d7b298f58b5&title=&width=1071.3333333333333)

比如一个 LDA X 操作。
LDA X：Load ACC X
取指周期：#0 #1 #2 （通常都是公用的，故而如果某个操作系统中有 n 条机器指令，则 CM 中的微程序段个数至少是 n+1 个）
#0: (PC) -> MAR, 1-> R
#1: M(MAR) -> MDR
#2: (MDR) -> IR
这里解释一下间指周期是否执行：
#2 指令给出下地址为 3，是要去进行间指周期的微程序的，然而一个指令不一定有寻址的操作，也就是不一定都有间指周期，所以会根据操作码判断下一条微指令是走间指周期还是不走间指周期，这个判决会放入标志位中。这个操作由顺序逻辑完成，如果标志为 false，那么顺序逻辑会将 #13 送入 CMAR 中，表示下一个应该执行的微指令地址为#13。
间指周期：#3...#7

具体工作流程
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703957574426-1d1484b3-9f4c-495f-8ad4-5af7c85313b1.png#averageHue=%23f2ebe8&clientId=u75f52eb8-4054-4&from=paste&height=123&id=u4e827dcf&originHeight=210&originWidth=852&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=49895&status=done&style=none&taskId=u6591dbab-afeb-48bb-a04e-76b412b68b6&title=&width=497)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703957581570-5a9ad2f7-6a62-43ff-8c3b-751d8da80eea.png#averageHue=%23eee8e5&clientId=u75f52eb8-4054-4&from=paste&height=171&id=u89080503&originHeight=306&originWidth=859&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=89165&status=done&style=none&taskId=u86f5a7a4-a996-431e-91c6-1c7b2385f78&title=&width=480.66668701171875)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703957589078-99afe89a-4969-427a-b62c-fcbe00786bd1.png#averageHue=%23f3eae7&clientId=u75f52eb8-4054-4&from=paste&height=162&id=u943084bd&originHeight=281&originWidth=769&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=71389&status=done&style=none&taskId=ua5fa3bcc-e1f7-4b0a-9226-4c0ceddc354&title=&width=443.66668701171875)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703957594800-bfee4aa1-60ed-4f55-8bac-ed6465ee8913.png#averageHue=%23f1eeec&clientId=u75f52eb8-4054-4&from=paste&height=172&id=u130eed73&originHeight=301&originWidth=868&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=70730&status=done&style=none&taskId=u8c7fbbea-09d4-4552-aaec-c09f327e8c7&title=&width=494.66668701171875)

### 举例—十进制加法
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703957910112-7c7bf41a-4b47-4aa1-9355-875862a6986b.png#averageHue=%23eae8e7&clientId=u75f52eb8-4054-4&from=paste&height=422&id=u83d2bbb1&originHeight=633&originWidth=862&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=92127&status=done&style=none&taskId=u2c0814ef-f2e9-40b7-8b01-e90073f844b&title=&width=574.6666666666666)
### CPU 周期与微指令周期的关系
为了保证机器控制信号的同步，可以将一个微指令周期时间设计得和 CPU 周期时间相等。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958260329-4d71b5b6-ce01-49ad-bea7-665322f74b46.png#averageHue=%23f1ecea&clientId=u75f52eb8-4054-4&from=paste&height=178&id=ue7eeacb0&originHeight=267&originWidth=765&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=72614&status=done&style=none&taskId=u1ba175ad-7c6f-4819-8230-fc9b3a4a077&title=&width=510)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958298240-c7827ddd-9e03-4577-a99e-9111e44f640c.png#averageHue=%23f2f0ef&clientId=u75f52eb8-4054-4&from=paste&height=382&id=u5d3a72be&originHeight=649&originWidth=871&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=118021&status=done&style=none&taskId=ucd912aa6-7d9b-4267-bc99-fb7a5b73d5c&title=&width=512.6666870117188)

### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958178433-b7a35d60-b432-4d5e-8ebb-60417320bf95.png#averageHue=%23edeae7&clientId=u75f52eb8-4054-4&from=paste&height=367&id=u85a6777d&originHeight=551&originWidth=820&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=310582&status=done&style=none&taskId=u634eed79-1921-4f5a-9b51-73a8b95de4c&title=&width=546.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958607891-3ab2e4df-5813-4472-985a-fefacaa6a9e2.png#averageHue=%23e5e1e0&clientId=u75f52eb8-4054-4&from=paste&height=358&id=u5259bb64&originHeight=837&originWidth=1255&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=372540&status=done&style=none&taskId=u8af83f90-1cb6-4fb4-b2af-10ffcdf4746&title=&width=537)
### ![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703956094235-8ddb4c95-9e7a-4db6-b7c6-9076c8ebec0d.png#averageHue=%23eeeeee&clientId=u75f52eb8-4054-4&from=paste&height=589&id=uf9632974&originHeight=883&originWidth=1519&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=515712&status=done&style=none&taskId=ub7da4ff9-f81b-45db-895b-cae3bfc0de8&title=&width=1012.6666666666666)
## 5.4.3 微指令设计
微指令的具体格式应该如何设计？
如何根据微指令发出相应的微命令？
微命令对应着一个输出。
有些微命令是可以并行的，也就是可以在一个 CPU 周期内实现。微指令可以包含多个微命令。

### 微指令格式
相容性微命令、互斥性微命令。

1. 水平型微指令
一条微指令定义并执行几种并行的操作。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958806059-24fcd3b3-f5c0-45aa-b6f9-cda6c682139c.png#averageHue=%23e1e1e1&clientId=u75f52eb8-4054-4&from=paste&height=126&id=ub852d7a1&originHeight=272&originWidth=812&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=41744&status=done&style=none&taskId=u2e90caea-3690-4f57-9c96-3850f0a2b4e&title=&width=375.3333435058594)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958970054-9777d8a1-610c-4cb8-a658-02e30d01bf20.png#averageHue=%23fdfdfc&clientId=u75f52eb8-4054-4&from=paste&height=71&id=uf7e16e35&originHeight=141&originWidth=987&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=17672&status=done&style=none&taskId=u1935879a-0d4d-419b-96b1-5589e3e0677&title=&width=500)

2. 垂直型微指令
一条微指令只能定义一个微命令，由微操作码字段规定具体功能。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703958821538-ab01ea66-9e68-4856-a9f8-4a449e604d8b.png#averageHue=%23e2e2e2&clientId=u75f52eb8-4054-4&from=paste&height=108&id=ub24f004a&originHeight=240&originWidth=1010&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=60327&status=done&style=none&taskId=u0c80ac8e-9571-4b4e-819a-c06bc21539b&title=&width=453.3333740234375)
3. 混合型微指令
在垂直型微指令的基础上加一些并行操作。
### 微指令编码方式

1. 直接编码方式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703951739098-23eb37a4-ae4a-4554-9438-01010a0a5a61.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=131&id=qhBah&originHeight=357&originWidth=1055&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=58189&status=done&style=none&taskId=ua4d4dd31-f003-4dfa-9ba0-784372391a3&title=&width=388.3333740234375)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703959311368-e435ff71-139a-463d-ac6c-fc5df4504f01.png#averageHue=%23ececec&clientId=u75f52eb8-4054-4&from=paste&height=171&id=ucba183d0&originHeight=451&originWidth=1239&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=224747&status=done&style=none&taskId=ub3bb4446-6a2a-470c-9b68-b1e1e13d2bc&title=&width=469)
举个例子，第一位的指令为(PC)->MAR，只需将这一位输出信号与 PCout 和 MARin 联通即可（内部总线）。

优点：不需要译码，设计简单，执行速度快，操作并行性较好。
缺点：微指令字过长，n 个微命令就需要微指令操作字段有 n 位（联想 3-8 译码器，这就像 8 这一端），造成控存容量极大。
微指令中通常只有个别字采用直接编码的方式。

2. 字段直接编码方式
将微指令分为若干段，每段经过译码后发出控制信号
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703962095676-76df377c-caa3-44a2-9119-ed92027ec394.png#averageHue=%23e6e6e6&clientId=u75f52eb8-4054-4&from=paste&height=298&id=u64cb944c&originHeight=566&originWidth=785&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=73670&status=done&style=none&taskId=udb474515-1b51-44ff-8874-0cde7278725&title=&width=413.3333740234375)
可以把互斥性微操作分在一个段中，并行的分在另一个段中，每个段只产出一个微操作，每个段的微操作可以并行。
注意每个小段的位数不能过多，否则会增加译码线路的复杂性和译码时间。
一般每个小段还要留一个状态编码，表示这段不产出任何微操作。比如 3bit 只能表达 7 个微操作，000 代表不操作。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703962289817-6ff9f61e-9fdb-40ac-98a1-c819d52bb20c.png#averageHue=%23d1cdcc&clientId=u75f52eb8-4054-4&from=paste&height=89&id=u610aab6d&originHeight=133&originWidth=1943&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=206430&status=done&style=none&taskId=u97e69f6c-6f39-443f-9573-ad03a615bcc&title=&width=1295.3333333333333)
15bit

3. 混合表示方式

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703962684304-4e1e9334-4814-48cf-b5dd-54da157be732.png#averageHue=%23fdfcfb&clientId=u75f52eb8-4054-4&from=paste&height=389&id=u11b2d838&originHeight=584&originWidth=1290&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=119298&status=done&style=none&taskId=ucf477ed8-a573-4771-b261-347a3fef384&title=&width=860)

4. 字段间接编码方式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703962750575-f10d0e1e-0d04-48f6-9f38-31e29a009c7d.png#averageHue=%23e7e6e6&clientId=u75f52eb8-4054-4&from=paste&height=237&id=u1990e42b&originHeight=469&originWidth=1159&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=284127&status=done&style=none&taskId=ua483058e-bef6-404f-9ac5-2c9db82dc07&title=&width=585)

字段 2 的数码经过译码后，再发送到别处辅助译码。
### 微指令的地址形成方式

1. 通过下地址字段指出。
由微指令的下地址字段直接给出后继指令的地址，这种方式又称为断定方式。
也叫多路转移方式。
2. 根据机器指令的操作码部分形成
机器指令取至 IR 后，微指令的地址由操作码经过微地址形成部件生成。
3. 增量计数法
(CMAR) + 1 -> CMAR  [(PC) + 1 -> PC]
4. 分支转移
转移方式：指明判决条件；
转移地址：指明转移成功后的去向。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963215928-f707fc55-4ffc-4213-8d9e-7641e8bffc1f.png#averageHue=%23d3d3d3&clientId=u75f52eb8-4054-4&from=paste&height=44&id=u1f812b94&originHeight=114&originWidth=1078&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=39859&status=done&style=none&taskId=u45de4805-1473-4a6d-bf1c-b5805308678&title=&width=412.66668701171875)

5. 通过测试网络
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963249428-fe745810-a0ae-4564-a958-6ae44d434283.png#averageHue=%23efefee&clientId=u75f52eb8-4054-4&from=paste&height=196&id=ud658e085&originHeight=444&originWidth=1267&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=100803&status=done&style=none&taskId=ucb7a0707-4708-47f1-9e5c-ef06ff52f1a&title=&width=560)
6. 由硬件产生微地址入口地址
第一条微指令地址由专门的硬件产生（用专门的硬件记录取指周期微程序首地址）。
中断周期也由硬件产生首地址。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963473391-5f6a0001-f81e-448e-8e4b-e4af06fb626f.png#averageHue=%23f4f3f2&clientId=u75f52eb8-4054-4&from=paste&height=401&id=u058ebbb8&originHeight=770&originWidth=1060&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=522540&status=done&style=none&taskId=u7dbd0bd1-3d05-4bfc-b005-6c8a72964d8&title=&width=552.6666870117188)
PPT：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963368745-30b60274-0b1d-4b00-a5d6-f253854405c2.png#averageHue=%23044b93&clientId=u75f52eb8-4054-4&from=paste&height=317&id=u6a45ad74&originHeight=737&originWidth=1294&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=377463&status=done&style=none&taskId=u4fa179eb-baed-411f-a5e9-ba2ff8b5312&title=&width=557)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963376420-fecb23fb-66ef-418c-b07c-8c4db08b7680.png#averageHue=%23768d93&clientId=u75f52eb8-4054-4&from=paste&height=428&id=u04614e31&originHeight=979&originWidth=1280&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=576491&status=done&style=none&taskId=ub9d25b83-bf94-4380-9a0e-fe632416264&title=&width=559)
## 5.4.4 微程序控制单元设计

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963696811-5ff9054a-a1d6-45c6-bef2-2632f3d9a7d5.png#averageHue=%23f0f0ee&clientId=u75f52eb8-4054-4&from=paste&height=365&id=ud84f5e9b&originHeight=594&originWidth=916&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=218563&status=done&style=none&taskId=u354ae3d1-614e-46e5-a17f-5f6efeeeb9a&title=&width=562.6666870117188)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963876106-dd47d96e-7d46-40c9-b868-dfb4a0ed679e.png#averageHue=%23efedec&clientId=u75f52eb8-4054-4&from=paste&height=853&id=ua66aa99c&originHeight=1280&originWidth=2027&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1037020&status=done&style=none&taskId=ufa4c3cf4-2630-46fa-84cc-cc4c32221a9&title=&width=1351.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963919078-881ea2ae-c871-4e51-bea6-294abe647e88.png#averageHue=%23f8f8f7&clientId=u75f52eb8-4054-4&from=paste&height=527&id=u21e58eb2&originHeight=791&originWidth=1989&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=665327&status=done&style=none&taskId=u40c05825-b76f-4b78-bcb6-dde7070c621&title=&width=1326)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1703963938569-c5aad1ff-b028-4275-b038-bdae1714d98c.png#averageHue=%23e2e2e2&clientId=u75f52eb8-4054-4&from=paste&height=650&id=uef7921a2&originHeight=975&originWidth=1627&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=586417&status=done&style=none&taskId=uff1641de-42fb-4d9f-9395-2d017115e98&title=&width=1084.6666666666667)


### 静态微程序合集和动态微程序设计
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704002913710-1fcb3110-fbf1-461b-91f9-d851d9df2d66.png#averageHue=%23f1f1f0&clientId=u75f52eb8-4054-4&from=paste&height=106&id=u5e552b44&originHeight=207&originWidth=965&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=147452&status=done&style=none&taskId=ub13af3e3-3a2f-4ce1-b65c-aa6e4eaf1d2&title=&width=495.3333740234375)

## 5.5.1 指令流水线

### 指令流水定义
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704003635588-ea55cd2c-1480-46cf-bb1e-56c69547a614.png#averageHue=%23f8f6f4&clientId=u75f52eb8-4054-4&from=paste&height=351&id=u1940ebeb&originHeight=526&originWidth=1022&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=116515&status=done&style=none&taskId=uf4b8b39c-fa4b-4410-8fec-ee9dd229eda&title=&width=681.3333333333334)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704003814426-4cdd32ec-fd4f-4d06-9b5b-77096b3fbb52.png#averageHue=%23edeae9&clientId=u75f52eb8-4054-4&from=paste&height=697&id=uf30827eb&originHeight=1045&originWidth=2262&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1319635&status=done&style=none&taskId=udbfcc030-6002-4199-af92-13979e690b7&title=&width=1508)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011731473-91a45c6d-c5bf-494e-93d8-9300c9556911.png#averageHue=%23f1f1f1&clientId=u75f52eb8-4054-4&from=paste&height=669&id=ud79aadfd&originHeight=1003&originWidth=1779&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=337297&status=done&style=none&taskId=u9383182b-832c-470a-ac8a-41004607b35&title=&width=1186)
### 时空图
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011600300-7d7816c3-eb12-49a5-a52e-ad65048a7842.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=219&id=u91cf62cc&originHeight=329&originWidth=560&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=29908&status=done&style=none&taskId=u884499b3-882f-4b4c-9ed2-84c0e976047&title=&width=373.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011605801-20cd00ef-6123-455c-b9ff-1c31079b9542.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=223&id=u94888684&originHeight=334&originWidth=576&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=35397&status=done&style=none&taskId=u5b06be4b-81e5-4e31-8770-27d494d832a&title=&width=384)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011610596-13e52015-fa67-4750-b183-38250319beb3.png#averageHue=%23fdfdfd&clientId=u75f52eb8-4054-4&from=paste&height=233&id=ueabfe045&originHeight=365&originWidth=540&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=52414&status=done&style=none&taskId=u4d8baa7a-b7e3-4241-a741-1c52c8dfa92&title=&width=344)
### 流水线性能指标

1. 吞吐率
吞吐率是指单位时间内流水线完成的任务数量。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011845680-b3baa3c1-68b6-4959-b2fa-237cecb58ba0.png#averageHue=%23efefef&clientId=u75f52eb8-4054-4&from=paste&height=620&id=u44407c42&originHeight=930&originWidth=1996&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=524742&status=done&style=none&taskId=u19298ee1-0d84-43cf-bd24-2b6d16545e9&title=&width=1330.6666666666667)
2. 加速比
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011904521-ee43d867-d173-4705-a04b-407d88802cd7.png#averageHue=%23eaeaea&clientId=u75f52eb8-4054-4&from=paste&height=587&id=u8b42182d&originHeight=880&originWidth=2053&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=551445&status=done&style=none&taskId=uc42fd55a-01a3-4dc8-917d-45d0ba677e3&title=&width=1368.6666666666667)
3. 效率
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704011989666-955edbc5-f938-4838-a6af-41871cf1278e.png#averageHue=%23edebeb&clientId=u75f52eb8-4054-4&from=paste&height=643&id=uc8704ff7&originHeight=964&originWidth=2032&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=728269&status=done&style=none&taskId=uc16d8523-256b-4700-bf57-e1485895ce2&title=&width=1354.6666666666667)





# 第六章 总线
## 6.0
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704012989514-983ed915-bae4-4429-902d-15f3f1a0ba61.png#averageHue=%23f6f6f5&clientId=u75f52eb8-4054-4&from=paste&height=746&id=ube496306&originHeight=1119&originWidth=1720&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=568019&status=done&style=none&taskId=u6d380d1c-9749-463c-a811-74ae32ff5ef&title=&width=1146.6666666666667)
## 6.1.1 概述
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704013502200-f5ed608c-7233-4873-a421-b094eff3b34f.png#averageHue=%23ece8e5&clientId=u75f52eb8-4054-4&from=paste&height=405&id=u91ef9d37&originHeight=1042&originWidth=1075&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=203152&status=done&style=none&taskId=u7990ffff-0aeb-4575-a362-a1814b7c856&title=&width=417.66668701171875)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704013524285-3a120c3a-852d-4c63-ae0f-2def7d50c8f1.png#averageHue=%23f3f5f0&clientId=u75f52eb8-4054-4&from=paste&height=191&id=u31d4b96b&originHeight=670&originWidth=1910&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=436267&status=done&style=none&taskId=ud34a3b86-2a98-43b1-a06c-a471f76fd7a&title=&width=545)
读写冲突，上面 4 根线构成一个 4bit 的一根总线。

## 6.1.2 总线概念及分类
### 概念
总线是计算机系统各个功能部件之间进行数据交换、分时共享公共信息的公共通路，由传输信息的电路和管理信息的协议组成。
### 分类
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704014904657-22a400c9-b9ca-4ab5-b88a-e45c435fbd30.png#averageHue=%23fefefe&clientId=u75f52eb8-4054-4&from=paste&height=200&id=u62c5a8d8&originHeight=704&originWidth=1942&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=311681&status=done&style=none&taskId=u06096ac5-89be-41fc-81ed-b4cdd06f0e2&title=&width=551)

1. 串行总线&并行总线
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704015832213-caffae61-9bc4-4540-a6fc-8b44c5e5e21f.png#averageHue=%23efe8e4&clientId=u75f52eb8-4054-4&from=paste&height=347&id=u0fef06b2&originHeight=862&originWidth=651&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=164229&status=done&style=none&taskId=u849a2b94-8a6e-4249-a910-36c28cf72ca&title=&width=262)
区别是传输的数据位数。串行总线只能一个 bit 一个 bit 地传送，而并行总线可以传送多个 bit 的信息。
串行总线只需要一根传输线，成本低，广泛应用于长距离传输，节省布线空间。
要考虑串行和并行转换的问题。
USB 给 PC 发送信息是串行方式，要经过转换后并行的送入。
并行总线时序逻辑简单，实现容易，占用空间，多跟传输线之间可能会相互干扰。
2. 片内总线&系统总线&通信总线
其中系统总线需要更细的划分：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704018959093-51a8a2ed-93bf-48e6-9bae-73f61651b3ce.png#averageHue=%23f0eeed&clientId=u75f52eb8-4054-4&from=paste&height=693&id=u7a2bed84&originHeight=1039&originWidth=2310&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1193443&status=done&style=none&taskId=u7497988f-40c4-4cd8-b7c1-a5ba2ba349b&title=&width=1540)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704019025604-6223bf0f-697d-434b-b499-a41c2c54db2f.png#averageHue=%23eae9e8&clientId=u75f52eb8-4054-4&from=paste&height=799&id=u24d53e3f&originHeight=1198&originWidth=2147&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1242935&status=done&style=none&taskId=u961e3eb5-7278-46f4-b724-56bbfdc9681&title=&width=1431.3333333333333)

### 系统总线的结构
单总线结构，双总线结构，三总线结构。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704019179362-d8353aee-4aae-4412-8de2-c8ddf7011ff8.png#averageHue=%23f0efef&clientId=u75f52eb8-4054-4&from=paste&height=640&id=u1648449b&originHeight=960&originWidth=2163&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=657501&status=done&style=none&taskId=u8472b99f-4a22-42cc-bc3e-797388dd871&title=&width=1442)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704020982340-7c64ddb6-e64a-47e5-b6b4-764c3980e8a0.png#averageHue=%23efefee&clientId=u75f52eb8-4054-4&from=paste&height=698&id=uaa374ed6&originHeight=1047&originWidth=2145&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=780727&status=done&style=none&taskId=u42bfe0ca-1706-4d14-9a4a-58e7f651593&title=&width=1430)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021065710-ee91e333-0eae-4241-9320-fad757b65905.png#averageHue=%23f0efef&clientId=u75f52eb8-4054-4&from=paste&height=660&id=u58bc1aea&originHeight=990&originWidth=2153&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=671955&status=done&style=none&taskId=u6d1f34aa-dbe2-429c-9939-ac4a659982c&title=&width=1435.3333333333333)
这部分和 PPT 中演示的结构不太相同：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021285686-5960c7d9-cbfb-498d-b9cb-527db01d781b.png#averageHue=%23dcdada&clientId=u75f52eb8-4054-4&from=paste&height=500&id=uba5e5464&originHeight=750&originWidth=1552&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=303113&status=done&style=none&taskId=uc1ac1b8f-964f-4847-a09a-e710641f688&title=&width=1034.6666666666667)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021294149-2738e9ab-9603-4657-bf5a-b7ae2b3c41c1.png#averageHue=%23f7f7f5&clientId=u75f52eb8-4054-4&from=paste&height=713&id=uf2c26b84&originHeight=1069&originWidth=1441&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=54286&status=done&style=none&taskId=ub0feb07d-6709-4f44-96c4-04e41b4e3d6&title=&width=960.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021311299-6590e33d-baad-4c08-aecb-30429a55172b.png#averageHue=%23e8e7e7&clientId=u75f52eb8-4054-4&from=paste&height=662&id=ucb8f3747&originHeight=993&originWidth=1536&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=250922&status=done&style=none&taskId=u65cf51b5-b5b7-4577-a9db-0c623cf61cb&title=&width=1024)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021326245-f31b2339-1b4b-4449-ba63-65e478d662ca.png#averageHue=%23e9e8e8&clientId=u75f52eb8-4054-4&from=paste&height=595&id=u919932ad&originHeight=893&originWidth=1596&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=384448&status=done&style=none&taskId=u49db148b-5c09-4c4e-98a4-335f29e90e3&title=&width=1064)![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021334721-bd79aac6-4121-4596-bc39-947bd55aebea.png#averageHue=%23f9f9f9&clientId=u75f52eb8-4054-4&from=paste&height=648&id=u033a328f&originHeight=972&originWidth=1622&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=58905&status=done&style=none&taskId=u3e2da795-34ce-413a-847c-2a5e8610fe6&title=&width=1081.3333333333333)




总线结构：
组成：总线通道，总线设备，总线控制器（总线接口）。
总线通道可以分为数据总线，地址总线，控制总线。
总线设备又分为主设备（Master）和从设备（Slave）。
Master 可以申请总线使用权，Slave 不具备总线使用权。

### 总线结构对计算机系统性能的影响
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704022009229-992d3d61-006e-4325-81a1-78e2de2ebfeb.png#averageHue=%23c7c7c7&clientId=u75f52eb8-4054-4&from=paste&height=457&id=ucf8f5b36&originHeight=686&originWidth=1465&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=333485&status=done&style=none&taskId=u38a0d48d-4175-4d95-8ee6-785c05ab7e4&title=&width=976.6666666666666)

### PPT 分类
其实就是按照功能划分为片内总线，系统总线，通信总线。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704015747326-84e404c9-3654-439a-9e5b-964ad873315f.png#averageHue=%23f0ebea&clientId=u75f52eb8-4054-4&from=paste&height=503&id=u0b44e6b5&originHeight=754&originWidth=1550&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=275097&status=done&style=none&taskId=u8f28c7be-8739-4a64-b1e3-c70401f8de5&title=&width=1033.3333333333333)
### 小结
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021102837-5da2a14a-d808-428d-a1c8-f5f22d3bab86.png#averageHue=%23fcfaf9&clientId=u75f52eb8-4054-4&from=paste&height=792&id=ued5ad25f&originHeight=1188&originWidth=2199&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=968125&status=done&style=none&taskId=u92f65500-dea3-4e43-a0d9-019e95acf14&title=&width=1466)


## 6.1.3 总线的性能指标

1. 总线传输周期
一次总线操作所需要的时间，包括申请阶段，传输阶段和结束阶段。通常由若干个总线时钟周期构成。经过一个总线传输周期后就可以传送一组数据。
2. 总线时钟周期
机器的时钟周期，由 CPU 发出。计算机有一个统一的时钟，以控制整个计算机的各个部件，总线也受此控制。现在的计算机中总线时钟周期也有可能是由桥接器提供。
3. 总线的工作频率
各种操作的频率。
若总线周期=N 个时钟周期，则总线的工作频率为时钟频率/N。
4. 总线的时钟频率
1s 内有多少时钟周期。
5. 总线带宽
总线位宽，是总线上能同时传送的数据位数，通常是指数据总线的根数，如 32 根线又称为 32 位总线。
6. 总线宽度
单位时间传输数据的位数。B/s MB/s
7. 总线复用
比如地址线和数据总线可以合并为一起。
但是速度会下降。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704027657550-e61cd8eb-0f8e-4262-9ad4-b6ffa1271333.png#averageHue=%23ece8e5&clientId=u75f52eb8-4054-4&from=paste&height=289&id=u827aad49&originHeight=672&originWidth=724&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=90888&status=done&style=none&taskId=ua2af8b41-0d41-463b-b690-4f02d5fc65b&title=&width=311.66668701171875)
8. 信号线数
地址总线、数据总线和控制总线的总和称为信号线数。



### 总线带宽计算
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704021704215-32578842-a49f-4d54-8805-868ae8a37613.png#averageHue=%23e2dedd&clientId=u75f52eb8-4054-4&from=paste&height=671&id=uac47c9e6&originHeight=1006&originWidth=1571&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=331157&status=done&style=none&taskId=ua40f06e4-730f-4dd9-9769-5de9676da49&title=&width=1047.3333333333333)

## 6.2 总线仲裁
### 基本概念
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704032784023-0cd259df-0c44-45ac-82d6-cc7d7742b297.png#averageHue=%23f1f1f1&clientId=u75f52eb8-4054-4&from=paste&height=121&id=u1113313e&originHeight=181&originWidth=758&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=23803&status=done&style=none&taskId=ua1e13278-677d-40c3-8d63-12b7663fc9e&title=&width=505.3333333333333)
同一时刻，只能有一个设备控制总线传输操作，可以有一个或多个设备从总线接收数据。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704032913700-6a60e01f-f953-406d-a0ab-d92b25852cef.png#averageHue=%23edeceb&clientId=u75f52eb8-4054-4&from=paste&height=549&id=uefa13f31&originHeight=824&originWidth=1381&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=448699&status=done&style=none&taskId=uaebab99c-3b22-40d6-b83f-2bd89cdadc0&title=&width=920.6666666666666)
### 集中仲裁方式

1. 链式仲裁方式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704033820543-11cef838-7a6f-46ae-82e7-fbd8462da2fb.png#averageHue=%23f1f1f1&clientId=u75f52eb8-4054-4&from=paste&height=208&id=r4RcB&originHeight=312&originWidth=887&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=69023&status=done&style=none&taskId=u148bf0ae-ecd5-4791-9aa6-082592358c3&title=&width=591.3333333333334)
BG（Bus Grant）是串联在设备 012 上的，节省了 BG 线，如果设备 1、2 想要使用总线，设备 1、2 会通过 BR 信号发送总线请求信号（高电平）。BG 通了高电平后，设备 0 由于没有发送 BR 请求，所以不会授权给设备 0，而 1、2 设备都发送了 BR，但是只有靠的近的设备 1 获得了 BG 授权，而设备 2 并没有 BG，这就是一种分配总线使用权的方式。
BS 信号由获得总线授权的设备 1 发出。
菊花链式仲裁方式的优先级是这样的：
离总线控制器越近的部件，优先级越高。
离总线控制器越远的部件，优先级越低。
优点：
链式查询方式优先级固定。只需要很少的几根控制线就能按一定次序实现总线控制。
缺点：
优先级不能改变。
对硬件电路故障敏感。（BG 坏了就全部无法授权）
优先级高的部件频繁使用总线时，优先级低的部件长期无法使用总线。
2. 计数器查询方式
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704034295438-0c7d0f24-d807-4348-83b3-dc9ced038132.png#averageHue=%23f0f0f0&clientId=u75f52eb8-4054-4&from=paste&height=201&id=uc7ed056a&originHeight=302&originWidth=885&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=61735&status=done&style=none&taskId=uc447ee65-f971-4b24-bf0b-60adc721ab9&title=&width=590)
用一个计数器控制总线的控制权，对比链式仲裁方式多了一组设备地址线，少了一根总线响应线 BG。
仍然公用一根 BR。
当总线控制部件收到 BR 请求时，



## 6.3 总线操作和定时
### 概念
占用总线的一对设备如何进行数据传输？
总线的一次信息传输过程分为 4(5) 个阶段：
申请分配阶段（请求总线、总线仲裁）、寻址、信息传送、状态返回。
为了同步主从方的操作，必须指定定时协议。
定时就是指事件出现在总线上的时序关系。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704035262387-8f3530cd-ebe1-4e27-b363-a52ffa2af7f5.png#averageHue=%23e7e6e6&clientId=u75f52eb8-4054-4&from=paste&height=433&id=uf67407f7&originHeight=650&originWidth=1452&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=478587&status=done&style=none&taskId=u1385e226-ff69-47a7-a804-a7887f7d9fd&title=&width=968)

### 同步定时方式（同步通信）
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704035519519-b9ee73d9-b918-416b-b791-46d3615c2179.png#averageHue=%23eae4df&clientId=u75f52eb8-4054-4&from=paste&height=467&id=u6e2f98ba&originHeight=701&originWidth=1559&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=396435&status=done&style=none&taskId=uad633a03-2694-4406-9b29-35e8d4f1b47&title=&width=1039.3333333333333)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704035550654-9f380fe9-6c90-468f-a4f7-06a4f7991ede.png#averageHue=%23e9e8e6&clientId=u75f52eb8-4054-4&from=paste&height=367&id=uba25be89&originHeight=550&originWidth=1195&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=376179&status=done&style=none&taskId=u73038357-8d76-4d10-ab65-417d9d70c06&title=&width=796.6666666666666)







# 第七章 I/O
## 7.0 重点
### 外围设备的功能、分类
### 显示设备的分类、显存的概念和计算【重点】
### 信息交换（IO 传送）控制方式：定义、应用场景
### 中断的定义、实质、特点、应用
### 响应中断的条件【重点】
### 中断服务程序入口地址的提供
向量中断和非向量中断
### 中断向量、向量表、向量地址的概念
### 中断类型码和中断向量表地址的关系
### 中断控制器的结构及工作原理【重点】
### 中断接口的组成、中断全过程
请求、判优、响应、处理
### DMA 定义、应用
DMA 传送的三个阶段。
DMA 传送方式。
DMA 控制器与接口。
### 通道的功能及类型
### 通用 IO 标准接口
## 7.1.1 输入输出系统和 IO 控制方式

![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704036069926-ad3ff156-25b3-4506-bbe4-8e4bf7020060.png#averageHue=%23eeedec&clientId=u75f52eb8-4054-4&from=paste&height=515&id=u02d33682&originHeight=773&originWidth=1457&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=306313&status=done&style=none&taskId=u7d777f97-a609-4e6c-b7f2-b2c30f4a385&title=&width=971.3333333333334)
主机如何与 IO 设备进行交互？
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704036688926-1e220ebe-466a-4bab-b8e4-d6d5f50f9f12.png#averageHue=%23f1f1f0&clientId=u75f52eb8-4054-4&from=paste&height=525&id=ud42c7b9e&originHeight=787&originWidth=1494&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=351985&status=done&style=none&taskId=uc6102eef-bec5-4b32-9b03-6cac1b4986a&title=&width=996)
通过 IO 接口。
过程如下：
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704125152943-17cbf048-0b59-43cf-a516-6212ba461d03.png#averageHue=%23dad7d7&clientId=u059706ea-c4ad-4&from=paste&height=293&id=ufab64ac4&originHeight=896&originWidth=1455&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=196046&status=done&style=none&taskId=u226c8b49-4def-469c-be9d-df917baa1c6&title=&width=476)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704125242916-881e93d5-9206-4450-aac4-de2d3585ba4f.png#averageHue=%23e9e8e7&clientId=u059706ea-c4ad-4&from=paste&height=531&id=u0fd19c1d&originHeight=1206&originWidth=2087&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1022021&status=done&style=none&taskId=u6c557c26-78fe-4759-a01a-496c7d88892&title=&width=919)

就是说，关键点在于 CPU 如何确定 IO 设备已经完成好输入数据或者取走数据了，这一个状态的完成。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704125337058-427d8755-cd34-454e-b191-759e859a912a.png#averageHue=%23f5f2ef&clientId=u059706ea-c4ad-4&from=paste&height=334&id=uee45418d&originHeight=775&originWidth=1637&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=106786&status=done&style=none&taskId=u16e77b55-9df3-4628-a8d2-f835db200b2&title=&width=705)
### 程序查询方式&程序中断方式流程
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704125536953-5a2c9635-d702-424c-9d88-be50efae6dfd.png#averageHue=%23e1dddd&clientId=u059706ea-c4ad-4&from=paste&height=478&id=uc0a84532&originHeight=717&originWidth=1761&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=387133&status=done&style=none&taskId=u91ebed9c-5f9f-4630-a3dd-c90e5834880&title=&width=1174)
对于程序中断方式，CPU 在请求好 IO 设备进行输入或读出时，让 IO 设备自己去做这项工作，然后 CPU 去做其它程序了，在 CPU 去执行其它指令时的末尾，会看一下有没有 IO 设备发送过来的中断请求，来取走 IO 设备的数据，CPU 这时中断别的服务程序，开始收尾 IO 设备与主机之间的数据传输。
## 



## 7.1.2 外部设备

![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704120938818-9919c88d-deb0-4c25-8746-1ecf4eb7dc33.png#averageHue=%23f0f095&clientId=ud487d7bb-849f-4&from=paste&height=679&id=ue6da6646&originHeight=1018&originWidth=1698&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=216164&status=done&style=none&taskId=u22f72cf7-1ba2-4a69-8b03-3993158e62b&title=&width=1132)
外围设备的功能是在计算机和其它机器或与用户之间提供联系。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704121056508-2ee46c9f-de98-442b-9646-20c0b817de33.png#averageHue=%23f8efec&clientId=ud487d7bb-849f-4&from=paste&height=417&id=u331076ea&originHeight=626&originWidth=1620&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=133824&status=done&style=none&taskId=u11e04acf-f53f-43e3-b59f-c065f414838&title=&width=1080)
### 磁盘设备
在第三章提及了。
### 显示设备
显示设备这部分重点是显示设备的分类和显存的概念与计算。
#### 分类
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124303250-268dc5f6-9532-4984-9f38-cd0c6777f532.png#averageHue=%23f5ede8&clientId=u059706ea-c4ad-4&from=paste&height=559&id=u8b8c73da&originHeight=838&originWidth=1507&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=193247&status=done&style=none&taskId=ue99999a4-8551-4ce9-bb21-aa527bb8a89&title=&width=1004.6666666666666)

#### 显存计算
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124795308-f45def56-a1e4-4c8c-9cf1-80ad9330e2a5.png#averageHue=%23fefefe&clientId=u059706ea-c4ad-4&from=paste&height=566&id=ub6c8481b&originHeight=849&originWidth=1386&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=204363&status=done&style=none&taskId=u0364162c-e8df-440b-aaa1-75152df75bd&title=&width=924)
显存 = 分辨率 × 颜色位数（比如 256 种颜色，那么颜色位数位 log2256 = 8）
而显存带宽需要用显存 × 刷新频率
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704124876314-f931b25b-87ae-45f5-9935-0e6797fbc772.png#averageHue=%23fbf9f7&clientId=u059706ea-c4ad-4&from=paste&height=573&id=u93efcaf9&originHeight=860&originWidth=1527&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=245631&status=done&style=none&taskId=ue23316df-2d78-4bdd-95de-75aa5977845&title=&width=1018)



## 7.2 IO 接口

## 7.3.1 程序查询方式



## 7.3.2 中断的作用和原理
### 中断定义
CPU 暂停执行现行程序，转去执行某个某个随机事态服务的中断处理程序。处理完毕后回到断点处继续执行程序。

### 中断过程

1. 请求
2. 判优
3. 响应
4. 处理
### 实质与特点
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704126431855-14daf9ed-ce90-4e04-97cc-757f23453f6f.png#averageHue=%23f8f8f8&clientId=u059706ea-c4ad-4&from=paste&height=172&id=uf206d5f3&originHeight=489&originWidth=1357&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=139962&status=done&style=none&taskId=ud958fc3a-26ac-4407-90e5-a2d89b971d6&title=&width=476)
修改 PC 的值。
特点是随机性。
### 应用
用于中低速的 IO 操作或者处理复杂随机事态。

### 响应中断的条件

1. 中断源有中断请求，且未被屏蔽。
2. CPU 允许中断，即开中断。
3. 一条指令（非停机指令）执行完毕。
4. 且没有更紧迫的优先级更高的任务，如故障、DMA 请求等。

### 分类
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704146478735-97e29ba6-089a-4f8b-ad75-447bfda7763e.png#averageHue=%23fcf1f1&clientId=u059706ea-c4ad-4&from=paste&height=623&id=ua81d0c65&originHeight=935&originWidth=1309&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=186422&status=done&style=none&taskId=u9f486dc4-6db0-488e-89b1-8c77c46a583&title=&width=872.6666666666666)


### 中断请求标记
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704148729022-c937d390-9a1e-4972-adce-611bd43d36df.png#averageHue=%23e5e5e5&clientId=u059706ea-c4ad-4&from=paste&height=332&id=uc94ac6ac&originHeight=498&originWidth=1339&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=237350&status=done&style=none&taskId=u098088b8-a212-465c-8ed0-a6509260b20&title=&width=892.6666666666666)
### 中断判优
可以有硬件或软件实现。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704147404061-67a75513-2feb-4094-ad70-5262c6561b29.png#averageHue=%23ecebeb&clientId=u059706ea-c4ad-4&from=paste&height=516&id=u1700e10b&originHeight=774&originWidth=1278&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=340665&status=done&style=none&taskId=u99e88e32-e751-4d76-a9ff-dda66545006&title=&width=852)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704147414004-e898424f-7266-442d-8469-d930f02acf44.png#averageHue=%23f9f7f5&clientId=u059706ea-c4ad-4&from=paste&height=220&id=u6d5002c4&originHeight=397&originWidth=774&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=61937&status=done&style=none&taskId=u3a87ec80-983e-41b9-bd82-2ac21bfc3a9&title=&width=429)

### 中断处理过程/中断隐指令
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704151313687-38cd46d6-4909-479e-b15d-73a15ef3fa4e.png#averageHue=%23efefef&clientId=u059706ea-c4ad-4&from=paste&height=438&id=u52392940&originHeight=657&originWidth=1350&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=248323&status=done&style=none&taskId=u4b999368-4d19-4b00-aa59-5a3cb53b584&title=&width=900)
PC 的值的修改由硬件实现，由中断隐指令实现。
中断隐指令：保存 PC 的值，并让 PC 指向中断服务程序的第一条指令。
问题：

1. PC 的值应该保存在哪里？
2. 如何找到特定的中断程序的入口地址。

这里先详细讲解一下隐指令。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704151770880-340c5cf3-82a2-4443-85a3-63eac67e54d7.png#averageHue=%23e4e4e3&clientId=u059706ea-c4ad-4&from=paste&height=775&id=uaf3182bc&originHeight=1162&originWidth=2237&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1064450&status=done&style=none&taskId=u0b80493b-80e8-4390-af87-1084eb3efb0&title=&width=1491.3333333333333)

### 获取中断服务程序的入口地址

1. 非向量中断
将服务程序入口组织在查询程序中，CPU 响应执行查询程序，查询中断源，转入相应的服务程序。
2. 向量中断
将服务程序入口（中断向量）组织在中断向量表中，CPU 相应时由硬件直接产生相应的向量地址，按地址查表，取得服务程序入口，转入相应服务程序。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704148079391-465151ad-0bf5-4aee-8630-45a3c2a71ffc.png#averageHue=%23efd7d3&clientId=u059706ea-c4ad-4&from=paste&height=99&id=u3fcabf9d&originHeight=218&originWidth=1099&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=99317&status=done&style=none&taskId=ua250bf60-6e89-4827-a905-65ec83a993a&title=&width=499)

这里的向量中断可以联系上图的隐指令。
向量表就是 12H、13H、14H 这段存储区域。
中断向量就是 JMP 200 这条指令的 200 地址。
向量地址就是 12H 这个中断向量的地址。

### 中断服务程序
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704151991593-85e7e48c-ae79-443e-9109-919940a3cea3.png#averageHue=%23eaeaea&clientId=u059706ea-c4ad-4&from=paste&height=772&id=u8ef78dbb&originHeight=1158&originWidth=2288&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=896015&status=done&style=none&taskId=ub6b5ebe8-2a30-4526-b584-780f98f6352&title=&width=1525.3333333333333)

## 7.3.3 多重中断


## 7.3.4 程序中断的方式


## 中断控制器的结构及工作原理【重点】
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704152763968-b3dbbb1d-1ef7-433b-84c9-a300a2eb8812.png#averageHue=%23f2f2f2&clientId=u059706ea-c4ad-4&from=paste&height=496&id=ue082ed65&originHeight=744&originWidth=1097&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=42138&status=done&style=none&taskId=uaee4d993-afe4-4335-82b7-165510af474&title=&width=731.3333333333334)
其实中断接口这是这张图。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704152799160-60b405d5-aa00-4cee-80c7-1176845a2357.png#averageHue=%23b4936b&clientId=u059706ea-c4ad-4&from=paste&height=435&id=u2f5118bf&originHeight=688&originWidth=997&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=284333&status=done&style=none&taskId=ube5928db-bde0-42dd-a392-ad593257f48&title=&width=629.6666870117188)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704152849047-41ef8b2f-c4b6-427b-8054-9eae08323fd1.png#averageHue=%23b2926d&clientId=u059706ea-c4ad-4&from=paste&height=200&id=u0a88593f&originHeight=359&originWidth=1107&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=168176&status=done&style=none&taskId=u16b27349-c605-48a7-955e-b1e2d0d7cc8&title=&width=616)


## 7.3.5 DMA 方式
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704126134545-33b5b36b-6c91-48f4-8154-b4da99757572.png#averageHue=%23bcded1&clientId=u059706ea-c4ad-4&from=paste&height=524&id=u53c941da&originHeight=786&originWidth=1357&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=444554&status=done&style=none&taskId=ud49b3e2b-cc1b-4f60-b319-c187cac9c25&title=&width=904.6666666666666)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704126158417-4c8b3224-03e9-4126-ac84-08f391c4297d.png#averageHue=%23ebe7e7&clientId=u059706ea-c4ad-4&from=paste&height=157&id=u9f9f14a2&originHeight=236&originWidth=1339&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=167870&status=done&style=none&taskId=u7be01074-db5b-43cf-ab76-f543b1ef940&title=&width=892.6666666666666)


## 通道
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704126187328-20619000-ec99-4891-9f4a-68bc1eb8e191.png#averageHue=%2392b864&clientId=u059706ea-c4ad-4&from=paste&height=467&id=ufdab0abf&originHeight=700&originWidth=1354&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=483217&status=done&style=none&taskId=u2eb262f6-faf7-48c6-b830-33cc301dd14&title=&width=902.6666666666666)


## 通用 IO 标准接口



















# 真题
## CPU
### 1
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704027783381-d9fb42c9-8d2a-4422-9587-bbca2972dd34.png#averageHue=%23f0efee&clientId=u75f52eb8-4054-4&from=paste&height=765&id=u206ce4b7&originHeight=399&originWidth=641&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=46466&status=done&style=none&taskId=uaaaf556c-4041-462c-b72a-76b3a15a096&title=&width=1229.3333435058594)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/33668709/1704027795248-55fd4870-34aa-4512-9bd2-54db30914731.png#averageHue=%23f5f2ef&clientId=u75f52eb8-4054-4&from=paste&height=448&id=ufb1bec51&originHeight=243&originWidth=667&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=75453&status=done&style=none&taskId=u6dae2fb3-01d6-434d-9ba1-f44eca4f81a&title=&width=1228.6666870117188)

1. 组成及主要寄存器的功能：

组成：该计算机主要由算术逻辑运算单元 ALU（其中 ALU 还包括 A 和 B 两个输入暂存寄存器，以及 ALU 上部三角代表着移位寄存器）、通用寄存器组 R0~R3、程序状态字寄存器 PSW、程序计数器 PC、操作控制器 CU 、指令寄存器 IR、地址寄存器 AR 和数据寄存器 DR 以及输入端口和输出端口。

答案：由算术逻辑运算单元、操作控制器组成。【我感觉标准答案应该是算术逻辑运算单元 ALU、操作控制器 CU、数据通路和外部，但是这里可能单指传统计算机，那便只有 CU 和 ALU】

主要寄存器功能：
PSW：存放程序状态标志数据，用来辅助时序逻辑控制。
R0~R3：用来存放 ALU 的操作数，~~作为暂存和缓存~~作为 CPU 的通用寄存器组。
AR：用来存放 PC 中的指令地址，用来寻址找到指令。
DR：用来存根据指令地址找到的主存中存放的数据，可以是间址或者数据（操作数）。
PC：是程序计数器，用来存放一系列将要进行的指令的地址，但是只保存当前指令的地址，在当前指令完成后自动+1 指向下一个指令地址。
IR：用来存放指令，是指令寄存器。

答案：
①ALU：算术逻辑运算单元。执行算术运算、逻辑运算并测试。

②操作控制器：协调和指挥整个系统的操作，取指令并执行。
③A和B---运算器前端的数据暂存器，也称运算寄存器。用来暂存参加运算的操作数。
④R0～R3----CPU的通用寄存器组。存放操作数。
⑤IR-指令寄存器器：保存当前正在执行的指令的指令码。
⑥PC-程序计数器：其保持的总是将要执行的下一条指令的地址。由于大多数指令都是按顺序来执行的，所以修改的过程通常只是简单的对PC加1。
⑦AR—地址寄存器：用来保存当前CPU所访问的内存单元的地址（指令地址或操作数地址）。
⑧DR—数据（缓冲）寄存器：用来暂存写入内存单元的数据及从内存单元读出的数据。

2. SUB R3，R2，(R1)
做出减法指令的指令周期流程图，并标注相应微命令信号。

![](https://cdn.nlark.com/yuque/0/2023/jpeg/33668709/1704030115337-92615227-cc04-4f4d-8e56-504bd08a1186.jpeg)

3. 

## IO 设备
### 1
![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704126609913-1f4328d2-e796-4ac7-b477-4eaa13b72575.png#averageHue=%23f7f6f5&clientId=u059706ea-c4ad-4&from=paste&height=468&id=u37c34afb&originHeight=702&originWidth=1005&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=177687&status=done&style=none&taskId=u1bf7ea12-2682-45e9-a7b6-88a7df3e765&title=&width=670)
first：

1. 应该采用程序中断方式。因为火灾是一种突发事件，因为火灾的紧急性，需要立刻发出警报，所以应该采用程序中断方式立即打断现行程序的进行，让报警程序立即执行。
2. ① CPU 开中断，允许中断。
② 中断源发出中断请求，且未屏蔽。
③ 一条指令（非停机指令）执行完成。
④ 没有优先级更高的中断请求，如 DMA、故障等。
### 2
![a573b6e8734404ec07ed73e310aca55.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704153439514-6d17c24a-d00e-4d81-b5df-c01ebc1ea3cd.png#averageHue=%237b9592&clientId=u059706ea-c4ad-4&from=paste&height=649&id=ue2fe369c&originHeight=973&originWidth=685&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=774743&status=done&style=none&taskId=u3319bb39-f580-448e-9504-8cc6a404214&title=&width=456.6666666666667)

1. 如何设置禁用发中断？
可以对中断请求触发器 IR 进行设置，使其输出信号始终未逻辑低电平（0）。
也可也对允许中断触发器 EI 进行设置，使 EI = 0，这样该设备就无法向 CPU 发送中断请求。
2. 如何设置关闭某中断源？
设置中断屏蔽触发器 IM = 0。
不会做。
是多重中断吗？有多个中断源。

## 磁盘
### 1
### ![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704155545749-9e6a9276-e821-4bf9-a34f-0f7252fe28e4.png#averageHue=%23f8f6f4&clientId=u059706ea-c4ad-4&from=paste&height=317&id=uc43d6ad5&originHeight=475&originWidth=1010&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=177267&status=done&style=none&taskId=u44d85219-bab2-43f1-a8c2-98a262904cf&title=&width=673.3333333333334)

1. 4×250×1000B = 106B
2. 采用磁盘 Cache 能够缓解主存和磁盘之间数据交换速度相差大的问题，能够提高主存从磁盘读取数据的速度，按照一定的规则缓存常用的磁盘数据，cache 和主存进行数据读写的速度远大于主存和磁盘读写数据的速度。
3. Dr = 5400 / 60 × 106 B/s = 9 × 107 B/s
提高转速或者每道记录面存储信息的位数。


![image.png](https://cdn.nlark.com/yuque/0/2024/png/33668709/1704155845507-721203c4-1e57-4afb-9cf8-fb76c9420415.png#averageHue=%23ededed&clientId=u059706ea-c4ad-4&from=paste&height=215&id=u020b4fff&originHeight=490&originWidth=1528&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=90838&status=done&style=none&taskId=uce8588e6-5626-49e4-8555-52e76526456&title=&width=670)
### 


